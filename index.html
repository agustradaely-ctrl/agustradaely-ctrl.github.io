<!DOCTYPE html>
<html lang="id">
<head>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff416c">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Photo Booth">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/192/1006/1006771.png">

<!-- Mobile Optimized -->
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhotoBooth- Studio Experience</title>

<!-- PREMIUM STYLES -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">


<style>
/* ===== GLOBAL BLUE & MINT LUXURY THEME ===== */
:root {
  /* Color System Blue & Mint Luxury */
  --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #4ECDC4 50%, #44A08D 100%);
  --secondary-gradient: linear-gradient(135deg, #74ebd5 0%, #9face6 100%);
  --accent-mint: #4ECDC4;
  --accent-blue: #667eea;
  --accent-purple: #764ba2;
  --gold-color: #FFD700;
  --platinum: #E8E8E8;
  --luxury-bg: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 50%, #f0fff0 100%);
  --card-bg: rgba(255, 255, 255, 0.95);
  --glass-effect: rgba(255, 255, 255, 0.92);
  --text-primary: #2C3E50;
  --text-secondary: #5D6D7E;
  --shadow-soft: 0 12px 40px rgba(102, 126, 234, 0.15);
  --shadow-medium: 0 20px 60px rgba(74, 205, 196, 0.2);
  --shadow-glow: 0 0 30px rgba(74, 205, 196, 0.4);
}

/* ===== RESET & GLOBAL STYLES ===== */
* {
  box-sizing: border-box;
}

body {
  font-family: 'Inter', 'SF Pro Display', -apple-system, sans-serif;
  background: var(--luxury-bg);
  color: var(--text-primary);
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  min-height: 100vh;
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(74, 205, 196, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: -1;
}

/* ===== GLASS MORPHISM LUXURY ===== */
.glass-card {
  background: var(--glass-effect);
  backdrop-filter: blur(50px);
  -webkit-backdrop-filter: blur(50px);
  border: 1.5px solid rgba(255, 255, 255, 0.8);
  border-radius: 28px;
  box-shadow: 
    var(--shadow-soft),
    inset 0 1px 20px rgba(255, 255, 255, 0.6);
  position: relative;
  overflow: hidden;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.glass-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, 
    rgba(102, 126, 234, 0.1) 0%, 
    rgba(74, 205, 196, 0.1) 50%, 
    rgba(255, 255, 255, 0.2) 100%);
  z-index: -1;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.glass-card:hover::before {
  opacity: 1;
}

.glass-card::after {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: var(--primary-gradient);
  border-radius: 30px;
  z-index: -2;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.glass-card:hover::after {
  opacity: 0.3;
}

/* ===== LUXURY BUTTONS BLUE & MINT ===== */
button, .btn-premium {
  background: var(--primary-gradient);
  border: none;
  border-radius: 20px;
  padding: 18px 36px;
  font-weight: 800;
  font-size: 16px;
  color: rgba(19, 166, 199, 0.833);
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-soft);
  letter-spacing: 0.8px;
  text-transform: uppercase;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

button::before, .btn-premium::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent, 
    rgba(255, 255, 255, 0.368), 
    rgba(255, 255, 255, 0), 
    rgba(255, 255, 255, 0), 
    transparent);
  transition: left 0.8s;
}

button:hover::before, .btn-premium:hover::before {
  left: 100%;
}

button:hover, .btn-premium:hover {
  transform: translateY(-6px) scale(1.05);
  box-shadow: 
    var(--shadow-medium),
    var(--shadow-glow);
  border-color: rgba(255, 255, 255, 0.6);
}

button:active, .btn-premium:active {
  transform: translateY(-2px) scale(1.02);
}

/* ===== MINT SPECIAL BUTTON ===== */
.btn-mint {
  background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
  box-shadow: 0 12px 40px rgba(74, 205, 196, 0.3);
}

.btn-mint:hover {
  box-shadow: 
    0 20px 50px rgba(74, 205, 196, 0.4),
    0 0 30px rgba(74, 205, 196, 0.5);
}

/* ===== BLUE SPECIAL BUTTON ===== */
.btn-blue {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  box-shadow: 0 12px 40px rgba(102, 126, 234, 0.3);
}

.btn-blue:hover {
  box-shadow: 
    0 20px 50px rgba(102, 126, 234, 0.4),
    0 0 30px rgba(102, 126, 234, 0.5);
}


/* ===== SIDEBAR LUXURY ===== */
#sidebar {
  background: linear-gradient(180deg, hsla(0, 0%, 100%, 0) 0%, hsla(172, 100%, 97%, 0.902) 100%) !important;
  border-right: 2px solid rgba(255, 255, 255, 0.8) !important;
  box-shadow: 
    12px 0 40px rgba(102, 126, 234, 0.15),
    inset 2px 0 20px rgba(255, 255, 255, 0.6) !important;
}

#sidebar li {
  background: rgba(255, 255, 255, 0.8) !important;
  margin: 15px 25px !important;
  border-radius: 20px !important;
  border: 2px solid rgba(255, 255, 255, 0.6) !important;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
  font-weight: 700 !important;
  color: var(--text-primary) !important;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08) !important;
  position: relative;
  overflow: hidden;
}

#sidebar li::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: var(--primary-gradient);
  transition: left 0.4s ease;
  z-index: -1;
}

#sidebar li:hover::before {
  left: 0;
}

#sidebar li:hover {
  color: white !important;
  transform: translateX(15px) scale(1.08) !important;
  box-shadow: 
    0 12px 30px rgba(102, 126, 234, 0.3),
    0 0 20px rgba(74, 205, 196, 0.4) !important;
  border-color: rgba(255, 255, 255, 0.8) !important;
}


body {
  font-family: 'Montserrat', sans-serif;
  background: linear-gradient(145deg, #0f2027, #203a43, #2c5364);
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #f0f0f0;
}

/* HEADER */
h1 {
  text-align: center;
  width: 100%;
  margin: 0 auto;
  font-size: 2.8em;
  margin-bottom: 20px;
  color: #ffffff;
  text-shadow: 0 0 20px #ff4d6d, 0 0 40px #ff4d6d66;
}

/* ===== SIDEBAR STYLING ===== */
#sidebar {
  position: fixed;
  left: 0;
  top: 0;
  width: 250px;
  height: 100%;
  background: linear-gradient(145deg, #1e3c72, #2a5298);
  color: white;
  display: flex;
  flex-direction: column;
  z-index: 1000;
  box-shadow: 2px 0 10px rgba(0,0,0,0.5);
  transition: transform 0.3s ease;
}

#sidebar ul {
  list-style: none;
  padding: 0;
  margin: 0;
  margin-top: 80px;
}

#sidebar li {
  padding: 15px 20px;
  cursor: pointer;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  transition: all 0.3s ease;
  font-weight: 500;
}

#sidebar li:hover {
  background: rgba(255,255,255,0.1);
  padding-left: 25px;
}

#sidebar li:active {
  background: rgba(255,255,255,0.2);
}

/* âœ… PERBAIKAN SIDEBAR STATES */
.sidebar-closed {
    transform: translateX(-100%) !important;
}

.sidebar-open {
    transform: translateX(0) !important;
}

/* âœ… HAMBURGER MENU STYLING YANG BENAR */
#hamburger-menu {
    position: fixed !important;
    top: 15px !important;
    left: 15px !important;
    font-size: 14px !important;
    cursor: pointer !important;
    z-index: 1001 !important;
    background: rgba(30, 60, 114, 0.9) !important;
    color: white !important;
    padding: 10px 15px !important;
    border-radius: 5px !important;
    transition: all 0.3s ease !important;
    display: none; /* Default hidden, akan dikontrol JS */
    border: 2px solid rgba(255,255,255,0.3) !important;
}

#hamburger-menu:hover {
    background: rgba(30, 60, 114, 1) !important;
    transform: scale(1.1) !important;
    box-shadow: 0 0 15px rgba(0,255,255,0.5) !important;
}

/* Konten Utama */
#mainContent {
  margin-left: 260px; /* Sesuaikan dengan lebar sidebar */
  padding: 20px;
  width: calc(100% - 260px);
  transition: margin-left 0.3s ease;
}

/* âœ… Ketika sidebar tertutup, adjust main content */
body.sidebar-closed #mainContent {
    margin-left: 0 !important;
    width: 100% !important;
}

/* Style untuk content sections */
.contentSection {
  background: rgba(255,255,255,0.1);
  padding: 20px;
  border-radius: 10px;
  margin-top: 20px;
  min-height: 400px;
}

.contentSection h2 {
  color: #00ffff;
  margin-bottom: 15px;
}

/* CAMERA CONTAINER */
/* âœ… PERBESAR CAMERA CONTAINER */
#camera-container {
  position: relative;
  display: none;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 20px 50px rgba(0,0,0,0.7);
  background: #111;
  border: 2px solid rgba(255,255,255,0.1);
  width: 100%;
  max-width: 1000px; /* âœ… DIPERBESAR LAGI DARI 800px */
  margin: 20px auto;
  aspect-ratio: 4/3;
  min-height: 600px; /* âœ… TINGGI MINIMAL */
}

/* âœ… PERBESAR VIDEO & CANVAS */
video, canvas, #frame-overlay {
  width: 100%;
  height: 100%;
  border-radius: 20px;
  object-fit: cover;
  box-shadow: inset 0 0 25px rgba(255,255,255,0.08);
  transform: scaleX(-1);
  min-height: 600px; /* âœ… PASTIKAN TINGGI CUKUP */
}

/* âœ… PERBESAR COUNTDOWN */
#countdown {
  position: absolute;
  top: 42%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 120px; /* âœ… DIPERBESAR DARI 95px */
  font-weight: 900;
  color: #00ffff;
  text-shadow: 0 0 10px #00ffff, 0 0 25px rgba(0,255,255,0.5);
  display: none;
}

/* âœ… PERBESAR VIDEO TIMER */
#videoTimer {
  position: absolute;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 32px; /* âœ… DIPERBESAR DARI 28px */
  font-weight: 700;
  color: #00ffea;
  background: rgba(0,0,0,0.55);
  padding: 12px 25px; /* âœ… PADDING DIPERBESAR */
  border-radius: 20px;
  display: none;
  box-shadow: 0 8px 25px rgba(0,255,255,0.25);
  text-shadow: 0 0 5px #00fff0;
}

/* FRAME OVERLAY */
#frame-overlay {
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
  display: none;
  border-radius: 20px;
  box-shadow: 0 0 25px rgba(255,255,255,0.2);
  transform: scaleX(-1);
  z-index: 2;
}


/* ===== BUTTONS PREMIUM ICON STYLE ===== */
button, select {
  margin: 8px;
  padding: 14px 24px;
  border-radius: 20px;
  border: none;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(12px);
}

button {
  background: linear-gradient(145deg, #ff416c, #ff4b2b);
  color: #fff;
  font-size: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.45);
  position: relative;
}

button::after {
  content: '';
  position: absolute;
  top:0; left:0;
  width: 100%; height: 100%;
  border-radius: 20px;
  box-shadow: 0 0 15px rgba(255,255,255,0.25);
  pointer-events: none;
}

button:hover {
  transform: translateY(-3px) scale(1.03);
  box-shadow: 0 12px 28px rgba(0,0,0,0.55), 0 0 12px rgba(255,255,255,0.3);
}

button:active {
  transform: translateY(1px) scale(0.99);
  box-shadow: 0 6px 18px rgba(0,0,0,0.55);
}

/* SELECT */
select {
  background: rgba(255,255,255,0.12);
  color: #fff;
  font-size: 15px;
  padding: 10px 16px;
  backdrop-filter: blur(8px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
}

/* ===== GALLERY THUMB ===== */
#gallery {
  margin-top: 30px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 16px;
}

.thumb {
  width: 100px;
  height: 75px;
  object-fit: cover;
  border-radius: 18px;
  cursor: pointer;
  box-shadow: 0 10px 28px rgba(0,0,0,0.45);
  transition: all 0.35s ease;
}

.thumb:hover {
  transform: scale(1.15) rotate(-1.5deg);
  box-shadow: 0 14px 38px rgba(0,0,0,0.6);
}

/* ===== MODAL PREVIEW ===== */
#previewModal {
  display: none;
  position: fixed;
  top: 0; left:0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.95);
  justify-content: center;
  align-items: center;
}

#previewWrapper {
  position: relative;
  display: flex;
  align-items: center;
  gap: 35px;
}

#previewModal img {
  max-width: 80%;
  max-height: 80%;
  border-radius: 25px;
  box-shadow: 0 0 45px rgba(0,255,255,0.5);
}

/* NAV BUTTONS */
.nav-btn {
  background: rgba(0,255,255,0.2);
  border: none;
  border-radius: 50%;
  font-size: 32px;
  font-weight: bold;
  cursor: pointer;
  padding: 16px 20px;
  transition: all 0.35s ease;
  color: #00ffff;
  text-shadow: 0 0 10px #00ffff;
}

.nav-btn:hover {
  background: rgba(0,255,255,0.5);
  transform: scale(1.2);
}

/* VIDEO CONTROLS */
#videoControls {
  display: none;
  position: absolute;
  bottom: 18px;
  left: 50%;
  transform: translateX(-50%);
  gap: 14px;
  z-index: 10;
}

/* ANIMASI SHRINK FADE */
@keyframes floatShrinkHold {
  0% { transform: scale(1) translateY(0); opacity: 1; }
  30% { transform: scale(1) translateY(0); opacity: 1; }
  100% { transform: scale(0.5) translateY(50px); opacity: 0; }
}

.float-shrink-hold {
  animation: floatShrinkHold 2s forwards;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

/* ===== Perbaikan dropdown select ===== */
select {
  color: #fff;
  background-color: rgba(0,0,0,0.4);
  border: 1px solid rgba(255,255,255,0.3);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  position: relative;
  padding-right: 30px;
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12'%3E%3Cpolygon points='0,0 12,0 6,6' fill='%23fff'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 12px;
}

select option {
  color: #000;
  background-color: #fff;
}

select option:hover {
  background-color: #00ffff33;
  color: #000;
}

  video, canvas, #frame-overlay {
    width: 100%;
    height: auto;
  }

  #videoControls {
    bottom: 10px;
  }

  #sidebar {
    width: 200px;
  }
  
  #mainContent {
    margin-left: 210px;
    width: calc(100% - 210px);
  }
  
  body.sidebar-closed #mainContent {
    margin-left: 0 !important;
    width: 100% !important;
  }


/* Pastikan frame mengikuti ukuran video/canvas */
#frameOverlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  pointer-events: none;
}

/* âœ… STYLE UNTUK MENU HOME FEEDBACK */
#menuHome {
  transition: all 0.2s ease;
  position: relative;
}

#menuHome:active {
  background: rgba(255,255,255,0.3) !important;
  transform: scale(0.95);
}

/* Animasi untuk double click feedback */
@keyframes homePulse {
  0% { background: rgba(255,255,255,0.1); }
  50% { background: rgba(0,255,255,0.3); }
  100% { background: rgba(255,255,255,0.1); }
}

.home-double-click {
  animation: homePulse 0.6s ease;
}

.custom-swal-popup {
    border-radius: 12px !important;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}

.custom-swal-title {
    color: #ffd700 !important; /* âœ… GOLD UNTUK KONTRA DENGAN HIJAU */
    font-size: 1.3rem !important;
    font-weight: bold !important;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.7) !important;
    margin-bottom: 0.8rem !important;
}

.custom-swal-text {
    color: #ffffff !important;
    font-size: 0.95rem !important;
    line-height: 1.4 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
}

.swal2-confirm {
    background: linear-gradient(145deg, #ff416c, #ff4b2b) !important;
    border: none !important;
    border-radius: 18px !important;
    padding: 8px 20px !important;
    font-weight: bold !important;
    font-size: 0.9rem !important;
    box-shadow: 0 4px 15px rgba(255, 65, 108, 0.3) !important;
}

.swal2-cancel {
    background: linear-gradient(145deg, #6c757d, #5a6268) !important;
    border: none !important;
    border-radius: 18px !important;
    padding: 8px 20px !important;
    font-weight: bold !important;
    font-size: 0.9rem !important;
}

/* âœ… UPDATE MAIN CONTAINER UNTUK KAMERA BESAR */
#main-container {
  display: flex;
  gap: 30px; /* âœ… JARAK DIPERBESAR */
  justify-content: center;
  align-items: flex-start;
  max-width: 200px; /* âœ… LEBAR MAX DIPERBESAR */
  margin: 0 auto;
  padding: 1px;
}

/* âœ… PERBESAR CENTER PANEL */
#center-panel {
  position: relative;
  flex: 1; /* âœ… GUNAKAN FLEX UNTUK RESPONSIVE */
  max-width: 1000px; /* âœ… MAX WIDTH BESAR */
}

/* âœ… SESUAIKAN PANEL KIRI & KANAN */
#left-panel, #right-panel {
  margin-top: 100px; /* âœ… SESUAIKAN POSISI VERTIKAL */
}

/* âœ… TOMBOL LEBIH BESAR UNTUK KAMERA BESAR */
#left-panel button, #right-panel select {
  padding: 16px 28px; /* âœ… TOMBOL LEBIH BESAR */
  font-size: 16px;
  min-width: 180px; /* âœ… LEBAR MINIMAL TOMBOL */
}

/* âœ… PAKET TIMER DISPLAY LEBIH BESAR */
#paketTimerDisplay {
  font-size: 28px; /* âœ… DIPERBESAR DARI 24px */
  font-weight: bold;
  color: #00ffea;
  background: rgba(0,0,0,0.5);
  padding: 12px 24px;
  border-radius: 20px;
  text-align: center;
  display: none;
  margin-bottom: 25px;
  box-shadow: 0 8px 25px rgba(0,255,255,0.3);
}

/* âœ… RESPONSIVE UNTUK KAMERA BESAR */
@media (max-width: 1200px) {
  #main-container {
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }
  
  #camera-container {
    max-width: 90%;
    min-height: 500px;
  }
  
  #left-panel, #right-panel {
    margin-top: 30px;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
  }
}

@media (max-width: 768px) {
  #camera-container {
    max-width: 95%;
    min-height: 400px;
    aspect-ratio: 3/4; /* âœ… ASPECT RATIO VERTICAL DI MOBILE */
  }
  
  #countdown {
    font-size: 80px; /* âœ… SESUAIKAN UNTUK MOBILE */
  }
  
  #videoTimer {
    font-size: 24px;
    padding: 8px 16px;
  }
}

@media (max-width: 480px) {
  #camera-container {
    min-height: 300px;
    max-width: 100%;
  }
  
  video, canvas, #frame-overlay {
    min-height: 300px;
  }

  @media (max-width: 768px) {
    #download-section {
        position: fixed;
        bottom: 10px;
        right: 10px;
        gap: 8px;
    }
    
    .btn-download-small, .btn-print-small {
        padding: 10px 16px;
        font-size: 12px;
        min-width: 100px;
    }
}

@media (max-width: 480px) {
    #download-section {
        bottom: 5px;
        right: 5px;
    }
    
    .btn-download-small, .btn-print-small {
        padding: 8px 12px;
        font-size: 11px;
        min-width: 90px;
    }
}
}

/* âœ… POPUP BUKTI PEMBAYARAN STYLE BANK */
.bukti-pembayaran-popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    justify-content: center;
    align-items: center;
}

.bukti-pembayaran-content {
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    width: 90%;
    max-width: 400px;
    border-radius: 15px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    color: #333;
    font-family: 'Montserrat', sans-serif;
}

/* HEADER BUKTI PEMBAYARAN */
.bukti-header {
    background: linear-gradient(145deg, #004b8d, #0066cc);
    color: white;
    padding: 20px;
    text-align: center;
}

.bukti-header h3 {
    margin: 0;
    font-size: 1.3em;
    font-weight: 700;
}

.bukti-header .bank-name {
    font-size: 0.9em;
    opacity: 0.9;
    margin-top: 5px;
}

/* BODY BUKTI PEMBAYARAN */
.bukti-body {
    padding: 20px;
}

.status-berhasil {
    text-align: center;
    color: #00a650;
    font-weight: bold;
    font-size: 1.2em;
    margin-bottom: 20px;
    padding: 10px;
    background: rgba(0, 166, 80, 0.1);
    border-radius: 8px;
}

.detail-transaksi {
    border-top: 2px dashed #ddd;
    border-bottom: 2px dashed #ddd;
    padding: 15px 0;
    margin: 15px 0;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.9em;
}

.detail-item .label {
    color: #666;
    font-weight: 500;
}

.detail-item .value {
    color: #333;
    font-weight: 600;
    text-align: right;
}

/* FOOTER DENGAN TOMBOL */
.bukti-footer {
    padding: 15px 20px;
    background: #f8f9fa;
    display: flex;
    justify-content: space-between;
    gap: 10px;
}

.btn-download {
    background: linear-gradient(145deg, #00a650, #008c46);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    justify-content: center;
    transition: all 0.3s ease;
}

.btn-oke {
    background: linear-gradient(145deg, #004b8d, #0066cc);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    flex: 1;
    transition: all 0.3s ease;
}

.btn-download:hover, .btn-oke:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

/* ANIMASI */
@keyframes slideInBukti {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(-50px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.bukti-pembayaran-content {
    animation: slideInBukti 0.4s ease-out;
}

/* âœ… MODAL PETUNJUK PENGGUNAAN */
.modal-popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: linear-gradient(145deg, #1e3c72, #2a5298);
    border-radius: 15px;
    width: 90%;
    max-width: 800px;
    max-height: 80vh;
    overflow: hidden;
    color: white;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.modal-header {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    color: #00ffea;
}

.close-modal {
    font-size: 28px;
    cursor: pointer;
    color: #ff416c;
}

.close-modal:hover {
    color: #ff4b2b;
}

/* TAB SYSTEM */
.tab-container {
    padding: 0;
}

.tab-buttons {
    display: flex;
    background: rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.tab-button {
    flex: 1;
    padding: 15px;
    background: none;
    border: none;
    color: #ccc;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.tab-button.active {
    background: rgba(255, 65, 108, 0.3);
    color: #fff;
    border-bottom: 3px solid #ff416c;
}

.tab-button:hover {
    background: rgba(255, 255, 255, 0.1);
}

.tab-content {
    padding: 20px;
    max-height: 400px;
    overflow-y: auto;
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
}

/* CONTENT STYLING */
.tab-pane h3 {
    color: #00ffea;
    margin-top: 0;
}

.tab-pane ol {
    line-height: 1.8;
    padding-left: 20px;
}

.tab-pane li {
    margin-bottom: 10px;
}

.guide-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.guide-item h4 {
    margin: 0 0 10px 0;
    color: #ffd700;
}

.package-comparison table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
}

.package-comparison th,
.package-comparison td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.package-comparison th {
    background: rgba(255, 65, 108, 0.3);
    color: #ffd700;
}

.package-comparison tr:hover {
    background: rgba(255, 255, 255, 0.05);
}

.faq-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.faq-item h4 {
    margin: 0 0 10px 0;
    color: #ffd700;
}

.faq-item p {
    margin: 0;
    color: #ccc;
}

.modal-footer {
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    text-align: center;
}

.btn-oke {
    background: linear-gradient(145deg, #ff416c, #ff4b2b);
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    font-size: 16px;
}

.btn-oke:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 65, 108, 0.4);
}

/* ==== TOMBOL DOWNLOAD & CETAK KECIL ==== */
.btn-download-small, .btn-print-small {
    background: var(--primary-gradient);
    border: none;
    border-radius: 15px;
    padding: 12px 20px;
    font-weight: 700;
    font-size: 14px;
    color: white;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-soft);
    letter-spacing: 0.5px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    min-width: 120px;
    text-align: center;
}

.btn-download-small {
    background: linear-gradient(145deg, #0072ff, #00c6ff);
}

.btn-print-small {
    background: linear-gradient(145deg, #ff8c00, #ff2d00);
}

.btn-download-small:hover, .btn-print-small:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: var(--shadow-medium), var(--shadow-glow);
    border-color: rgba(255, 255, 255, 0.6);
}

.btn-download-small:active, .btn-print-small:active {
    transform: translateY(-1px) scale(1.02);
}

/* Efek ripple untuk tombol kecil */
.btn-download-small::before, .btn-print-small::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s;
}

.btn-download-small:hover::before, .btn-print-small:hover::before {
    left: 100%;
}

/* ğŸ  PERBAIKI GALLERY CONTAINER */
#gallery-container {
    position: relative;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    padding: 0 60px;
    overflow: hidden;
    border: 2px solid rgba(0, 255, 255, 0.3); /* ğŸ¯ BORDER UNTUK DEBUG */
    border-radius: 15px;
    background: rgba(0, 0, 0, 0.2);
}

/* ğŸ  PERBAIKI GALLERY - FORCE SINGLE LINE */
#gallery {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    scroll-behavior: smooth;
    scroll-snap-type: x proximity;
    padding: 15px 10px;
    width: 100%;
    min-height: 135px; /* ğŸ¯ TINGGI TETAP */
    scrollbar-width: none;
    -ms-overflow-style: none;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    
    /* ğŸ¯ PROPERTI PENTING: FORCE SINGLE LINE */
    flex-wrap: nowrap !important; /* ğŸ¯ JANGAN PERNAH WRAP KE BARIS BARU */
    white-space: nowrap !important;
    max-width: none !important; /* ğŸ¯ HAPUS BATASAN LEBAR */
}

#gallery::-webkit-scrollbar {
    display: none;
}

/* ğŸ  THUMBNAIL - UKURAN TETAP */
.thumb, .gallery > div {
    width: 140px !important;
    height: 105px !important;
    border-radius: 12px;
    object-fit: cover;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    flex-shrink: 0 !important;
    display: block !important;
    flex: 0 0 auto !important;
    scroll-snap-align: start;
}

/* ğŸ  TOMBOL SCROLL */
.scroll-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 255, 255, 0.9) !important;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 24px;
    font-weight: bold;
    color: #000 !important;
    cursor: pointer;
    z-index: 1000;
    display: flex !important;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
    transition: all 0.3s ease;
}

.scroll-btn:hover {
    background: rgba(0, 255, 255, 1) !important;
    transform: translateY(-50%) scale(1.1);
}

#scrollLeftBtn {
    left: 5px;
}

#scrollRightBtn {
    right: 5px;
}

/* ğŸ  PASTIKAN UKURAN GALLERY CONSISTENT */
#gallery {
    display: flex !important;
    flex-wrap: nowrap !important;
    white-space: nowrap !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    width: 100% !important;
    max-width: 480px !important; /* ğŸ¯ 3 THUMBNAIL: (140+15)*3 = 465px */
    min-height: 135px !important;
    scroll-behavior: smooth !important;
}

/* ğŸ  THUMBNAIL SIZE YANG PASTI */
.thumb, #gallery > div {
    width: 140px !important;
    height: 105px !important;
    flex-shrink: 0 !important;
    flex-grow: 0 !important;
    display: block !important;
}

</style>
</head>
<body>

<!-- âœ… LUXURY PARTICLE BACKGROUND -->
<div id="luxury-particles" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; opacity: 0.6;"></div>

<!-- ===== âœ… HARUS DI BAWAH INI: HAMBURGER & SIDEBAR ===== -->
<div id="hamburger-menu" style="display:none;">â˜°</div>
<!-- Sidebar Vertikal -->
<div id="sidebar">
  <ul>
    <li id="menuLogin">ğŸ” Login/Register</li>
    <li id="menuHome">ğŸ Home</li>
    <li id="menuGuide">ğŸ“– Petunjuk Penggunaan</li>
    <li id="menuHubungi">ğŸ“ Hubungi Kami</li>
  </ul>
</div>


<!-- ===== DASHBOARD UTAMA ===== -->
<div id="dashboard" style="text-align:center; margin-top:80px;">
  <h1>Selamat Datang di Web PhotoBooth</h1>
  
  <!-- âœ… STATUS PEMBAYARAN LEBIH DETAIL -->
  <div id="statusPembayaran" style="margin:20px auto; padding:15px; border-radius:10px; 
              max-width:500px; display:none;">
    <!-- Status akan diisi oleh JavaScript -->
  </div>
  
  <p>Pilih menu di bawah ini untuk melanjutkan:</p>
  <button onclick="showSection('paket')">ğŸ“¦ Menu Paket</button>
  <button onclick="showSection('pembayaran')">ğŸ’³ Menu Pembayaran</button>
  <button onclick="showSection('photobooth')">ğŸ¥ Masuk ke PhotoBooth</button>
</div>

<div id="photobooth-section" style="display:none;">
  <h1>ğŸ“¸ Photo Booth</h1>

<!-- MAIN CONTAINER 3 KOLOM -->
<div id="main-container" style="display:flex; gap:20px; justify-content:center; align-items:flex-start; max-width:1200px; margin:0 auto;">


  <!-- KOLOM KIRI: tombol utama -->
  <div id="left-panel" style="display:flex; flex-direction:column; gap:50px; margin-top:70px;">
    <button id="startBtn">Nyalakan Kamera</button>
    <button id="captureBtn">Ambil Foto</button>
    <button id="videoBtn">Video</button>
    <button id="deleteBtn">Hapus Foto/Video</button>
    <button id="stopBtn">Matikan Kamera</button>
  </div>

  <!-- KOLOM TENGAH: kamera & video -->
  <div id="center-panel" style="position:relative;">
    <div id="paketTimerDisplay" 
     style="font-size: 24px; font-weight: bold; color: #00ffea; 
            background: rgba(0,0,0,0.5); padding: 8px 18px; 
            border-radius: 18px; text-align:center; display:none;
            margin-bottom: 2px;">
</div>
    <div id="camera-container">
      <video id="video" autoplay></video>
      <canvas id="canvas" style="display:none;"></canvas>
      <img id="frame-overlay" src="" alt="Frame Overlay">
      <div id="countdown"></div>
      <div id="videoTimer"></div>
      <div id="videoControls">
        <button id="startRecBtn">âº</button>
        <button id="pauseRecBtn" style="display:none;">â¸</button>
        <button id="resumeRecBtn" style="display:none;">â¯</button>
        <button id="stopRecBtn" style="display:none;">â¹</button>
      </div>
    </div>
  </div>

  <!-- KOLOM KANAN: timer, filter, frame -->
  <div id="right-panel" style="display:flex; flex-direction:column; gap:42px; margin-top:100px;">
    <label for="timerSelect">Timer:</label>
    <select id="timerSelect">
      <option value="0">Tanpa Timer</option>
      <option value="3">3 Detik</option>
      <option value="5">5 Detik</option>
      <option value="10">10 Detik</option>
    </select>

    <label for="filterSelect">Filter:</label>
    <select id="filterSelect">
      <option value="none">Normal</option>
      <option value="grayscale(1)">Grayscale</option>
      <option value="sepia(1)">Sepia</option>
      <option value="contrast(1.5)">Kontras Tinggi</option>
      <option value="brightness(1.3)">Lebih Cerah</option>
      <option value="blur(2px)">Blur</option>
    </select>

    <label for="frameSelect">Frame:</label>
    <select id="frameSelect">
      <option value="">Tanpa Frame</option>
      <option value="frame1.png">Frame 1</option>
      <option value="frame2.png">Frame 2</option>
      <option value="frame3.png">Frame 3</option>
      <option value="frame4.png">Frame 4</option>
      <option value="frame5.png">Frame 5</option>
      <option value="frame6.png">Frame 6</option>
    </select>
    
  </div>
</div>

<!-- ==================== HTML GALLERY YANG DIPERBAIKI ==================== -->
<h3 style="text-align:center; margin-top:10px;">Hasil Foto/Video</h3>

<!-- ğŸ  GALLERY CONTAINER DENGAN SCROLL -->
<div id="gallery-container" style="position: relative; max-width: 600px; margin: 0 auto; padding: 0 50px;">  
    <!-- ğŸ  TOMBOL SCROLL KIRI -->
    <button id="scrollLeftBtn" class="scroll-btn" style="display: none;">  
        &lt;  
    </button>

    <!-- ğŸ  GALLERY DENGAN SCROLL -->
    <div id="gallery" style="display: flex; gap: 16px; overflow-x: auto; scroll-behavior: smooth; padding: 10px 5px; max-width: 100%;"></div>

    <!-- ğŸ  TOMBOL SCROLL KANAN -->
    <button id="scrollRightBtn" class="scroll-btn" style="display: none;">  
        &gt;  
    </button>
</div>

<div id="download-section" style="position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 1000;">
    <button id="downloadBtn" class="btn-download-small">
        ğŸ’¾ Download Foto/Video
    </button>
    <button id="printBtn" class="btn-print-small">
        ğŸ–¨ Cetak Foto
    </button>
</div>
</div>

<div id="previewModal" onclick="this.style.display='none'">
  <div id="previewWrapper" onclick="event.stopPropagation()">
    <button id="prevBtn" class="nav-btn" onclick="showPrev(event)">&lt;</button>
    <img id="previewImage" src="">
    <button id="nextBtn" class="nav-btn" onclick="showNext(event)">&gt;</button>
  </div>
</div>

<section id="pembayaran-section" style="display:none; text-align:center; margin-top:30px;">
  <h2>ğŸ’³ Menu Pembayaran</h2>
  <p>Isi data dan pilih metode pembayaran Anda.</p>

  <form id="formPembayaran" style="max-width:400px; margin:auto;">
    <label>Nama:</label><br>
    <input type="text" id="nama" placeholder="Nama penyewa" required><br><br>

    <label>Email:</label><br>
    <input type="email" id="email" placeholder="Email penyewa" required><br><br>

    <label>No. HP:</label><br>
    <input type="tel" id="nohp" placeholder="08xxxxxxxxxx" required><br><br>

    <!-- âœ… FIELD JENIS PAKET -->
    <label>Jenis Paket:</label><br>
    <input type="text" id="jenisPaket" readonly style="
        background: rgba(255,255,255,0.1);
        color: #ffffff;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 10px;
        border-radius: 8px;
        width: 100%;
        box-sizing: border-box;
        cursor: not-allowed;
    "><br><br>

    <!-- âœ… FIELD BARU: HARGA PAKET -->
    <label>Harga Paket:</label><br>
    <input type="text" id="hargaPaket" readonly style="
        background: rgba(255,255,255,0.1);
        color: #ffffff;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 10px;
        border-radius: 8px;
        width: 100%;
        box-sizing: border-box;
        cursor: not-allowed;
        font-weight: bold;
        color: #00ffea;
    "><br><br>

    <label>Metode Pembayaran:</label><br>
    <select id="metode">
      <option value="">-- Pilih Metode --</option>
      <option value="transfer">Transfer Bank</option>
      <option value="qris">QRIS</option>
      <option value="ewallet">E-Wallet (Dana, OVO, Gopay)</option>
    </select><br><br>

    <button type="button" onclick="kirimPembayaran()">Kirim Pembayaran</button>
  </form>

  <div id="hasilPembayaran" style="margin-top:20px; display:none;"></div>
</section>

<!-- ===== MENU PAKET ===== -->
<section id="paket-section" style="display:none; text-align:center; margin-top:30px;">
  <h2>ğŸ“¦ Pilihan Paket Photo Booth</h2>
  <p>Pilih paket sesuai kebutuhan acara Anda.</p>

  <div style="display:flex; justify-content:center; flex-wrap:wrap; gap:20px; margin-top:30px;">

    <!-- âœ… PAKET TRIAL BARU -->
    <div style="background:linear-gradient(145deg, #4CAF50, #45a049); color:white; padding:20px; border-radius:10px; width:250px;">
      <h3>ğŸ¯ Paket Trial</h3>
      <p>Durasi: 10 menit</p>
      <p>3 Foto + 1 Video</p>
      <p>Harga: <strong>GRATIS</strong></p>
      <button onclick="pilihPaket('Trial')" style="background:linear-gradient(145deg, #FF9800, #F57C00);">Coba Sekarang</button>
    </div>

    <!-- Paket Basic -->
    <div style="background:#222; color:white; padding:20px; border-radius:10px; width:250px;">
      <h3>ğŸ“¸ Paket Basic</h3>
      <p>Durasi: 1 jam</p>
      <p>10 Foto + 2 Video</p>
      <p>Harga: Rp 10.000</p>
      <button onclick="pilihPaket('Basic')">Pilih Paket Ini</button>
    </div>

    <!-- Paket Premium -->
    <div style="background:#333; color:white; padding:20px; border-radius:10px; width:250px;">
      <h3>ğŸŒŸ Paket Premium</h3>
      <p>Durasi: 2 jam</p>
      <p>20 Foto + 5 Video</p>
      <p>Harga: Rp 15.000</p>
      <button onclick="pilihPaket('Premium')">Pilih Paket Ini</button>
    </div>

    <!-- Paket VIP -->
    <div style="background:#444; color:white; padding:20px; border-radius:10px; width:250px;">
      <h3>ğŸ‘‘ Paket VIP</h3>
      <p>Durasi: 3 jam</p>
      <p>Unlimited Foto + 10 Video</p>
      <p>Harga: Rp 20.000</p>
      <button onclick="pilihPaket('VIP')">Pilih Paket Ini</button>
    </div>
  </div>
</section>

<!-- âœ… POPUP BUKTI PEMBAYARAN -->
<div id="buktiPembayaranPopup" class="bukti-pembayaran-popup">
    <div class="bukti-pembayaran-content">
        <!-- Header -->
        <div class="bukti-header">
            <h3>m-Transfer</h3>
            <div class="bank-name">Photo Booth</div>
        </div>
        
        <!-- Body -->
        <div class="bukti-body">
            <div class="status-berhasil">BERHASIL</div>
            
            <div class="detail-transaksi">
                <div class="detail-item">
                    <span class="label">Tanggal/Waktu</span>
                    <span class="value" id="buktiTanggal">11/11/2025 19:35:15</span>
                </div>
                <div class="detail-item">
                    <span class="label">No. Referensi</span>
                    <span class="value" id="buktiReferensi">9503120251111935144178648B87</span>
                </div>
                <div class="detail-item">
                    <span class="label">Metode</span>
                    <span class="value" id="buktiMetode">GOPAY</span>
                </div>
                <div class="detail-item">
                    <span class="label">Jenis Paket</span>
                    <span class="value" id="buktiJenisPaket">-</span>
                </div>
                <div class="detail-item">
                    <span class="label">Nama Penyewa</span>
                    <span class="value" id="buktiNama">-</span>
                </div>
                <div class="detail-item">
                    <span class="label">Email</span>
                    <span class="value" id="buktiEmail">-</span>
                </div>
                <div class="detail-item">
                    <span class="label">No. HP</span>
                    <span class="value" id="buktiNoHP">-</span>
                </div>
            </div>
            
            <div class="detail-item" style="margin-top: 15px;">
                <span class="label">TOTAL TAGIHAN</span>
                <span class="value" style="color: #004b8d; font-size: 1.1em;" id="buktiTotal">Rp 0</span>
            </div>
            
            <div style="text-align: center; margin-top: 15px; font-size: 0.8em; color: #666;">
                Biaya Termasuk PPN (Bila ada)<br>
                PT. PHOTO BOOTH KELOMPOK 3<br>
                NPWP : 0013084496091000
            </div>
        </div>
        
        <!-- Footer dengan Tombol -->
        <div class="bukti-footer">
            <button class="btn-download" onclick="downloadBuktiPembayaran()">
                â¬‡ Download Struk
            </button>
            <button class="btn-oke" onclick="tutupBuktiPembayaran()">
                OK
            </button>
        </div>
    </div>
</div>

<!-- âœ… TAMBAHKAN HTML UNTUK MODAL PETUNJUK -->
<div id="petunjukModal" class="modal-popup">
    <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
        <div class="modal-header">
            <h2>ğŸ“– Petunjuk Penggunaan Photo Booth</h2>
            <span class="close-modal">&times;</span>
        </div>
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="panduan-cepat">ğŸš€ Panduan Cepat</button>
                <button class="tab-button" data-tab="cara-pakai">ğŸ¥ Cara Pakai</button>
                <button class="tab-button" data-tab="paket-harga">ğŸ’° Paket & Harga</button>
                <button class="tab-button" data-tab="faq">â“ FAQ</button>
            </div>
            
            <div class="tab-content">
                <div id="panduan-cepat" class="tab-pane active">
                    <h3>Langkah-Langkah Cepat:</h3>
                    <ol>
                        <li>ğŸ” <strong>Login/Register</strong> - Buat akun atau masuk</li>
                        <li>ğŸ“¦ <strong>Pilih Paket</strong> - Trial, Basic, Premium, atau VIP</li>
                        <li>ğŸ’³ <strong>Bayar</strong> - Untuk paket berbayar (Trial gratis)</li>
                        <li>ğŸ¥ <strong>Photo Booth</strong> - Ambil foto & video</li>
                        <li>ğŸ“¥ <strong>Download</strong> - Simpan hasil ke device</li>
                    </ol>
                </div>
                
                <div id="cara-pakai" class="tab-pane">
                    <h3>ğŸ¥ Cara Menggunakan Photo Booth:</h3>
                    <div class="feature-guide">
                        <div class="guide-item">
                            <h4>ğŸ“¸ Ambil Foto</h4>
                            <p>Klik tombol <strong>"Ambil Foto"</strong> - Bisa pakai timer 3, 5, atau 10 detik</p>
                        </div>
                        <div class="guide-item">
                            <h4>ğŸ¥ Rekam Video</h4>
                            <p>Klik tombol <strong>"Video"</strong> - Lalu âº untuk mulai rekam, â¹ untuk stop</p>
                        </div>
                        <div class="guide-item">
                            <h4>ğŸ¨ Filter & Frame</h4>
                            <p>Pilih filter dan frame dari panel kanan untuk efek khusus</p>
                        </div>
                        <div class="guide-item">
                            <h4>ğŸ–¼ Lihat Hasil</h4>
                            <p>Klik thumbnail di gallery untuk preview di layar utama</p>
                        </div>
                    </div>
                </div>
                
                <div id="paket-harga" class="tab-pane">
                    <h3>ğŸ’° Pilihan Paket:</h3>
                    <div class="package-comparison">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fitur</th>
                                    <th>ğŸ¯ Trial</th>
                                    <th>ğŸ“¸ Basic</th>
                                    <th>ğŸŒŸ Premium</th>
                                    <th>ğŸ‘‘ VIP</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Durasi</td>
                                    <td>10 menit</td>
                                    <td>1 jam</td>
                                    <td>2 jam</td>
                                    <td>3 jam</td>
                                </tr>
                                <tr>
                                    <td>Foto</td>
                                    <td>3</td>
                                    <td>10</td>
                                    <td>20</td>
                                    <td>30</td>
                                </tr>
                                <tr>
                                    <td>Video</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>5</td>
                                    <td>10</td>
                                </tr>
                                <tr>
                                    <td>Harga</td>
                                    <td>GRATIS</td>
                                    <td>Rp 10.000</td>
                                    <td>Rp 15.000</td>
                                    <td>Rp 20.000</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="faq" class="tab-pane">
                    <h3>â“ Pertanyaan Umum:</h3>
                    <div class="faq-item">
                        <h4>Q: Apakah Trial benar-benar gratis?</h4>
                        <p>A: Ya! Trial gratis dengan 3 foto + 1 video, sekali pakai per akun.</p>
                    </div>
                    <div class="faq-item">
                        <h4>Q: Bagaimana cara download hasil?</h4>
                        <p>A: Klik tombol ğŸ“¥ Download Hasil di bagian bawah photo booth.</p>
                    </div>
                    <div class="faq-item">
                        <h4>Q: Hasil foto/video tersimpan di mana?</h4>
                        <p>A: Tersimpan di akun Anda, aman walaupun logout/refresh.</p>
                    </div>
                    <div class="faq-item">
                        <h4>Q: Bisa pakai di mobile?</h4>
                        <p>A: Bisa! Aplikasi responsive untuk desktop & mobile.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn-oke" onclick="tutupPetunjuk()">Mengerti</button>
        </div>
    </div>
</div>

<script>

// âœ… LUXURY PARTICLE SYSTEM
function createLuxuryParticles() {
    const container = document.getElementById('luxury-particles');
    if (!container) return;
    
    const colors = ['#667eea', '#4ECDC4', '#74ebd5', '#9face6', '#FFD700', '#ffffff'];
    const shapes = ['circle', 'square', 'triangle'];
    
    for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        const size = Math.random() * 25 + 8;
        const color = colors[Math.floor(Math.random() * colors.length)];
        const shape = shapes[Math.floor(Math.random() * shapes.length)];
        
        particle.style.cssText = `
            position: absolute;
            background: ${color};
            width: ${size}px;
            height: ${size}px;
            border-radius: ${shape === 'circle' ? '50%' : shape === 'triangle' ? '0' : '4px'};
            opacity: ${Math.random() * 0.3 + 0.1};
            left: ${Math.random() * 100}vw;
            top: ${Math.random() * 100}vh;
            animation: float-luxury ${Math.random() * 15 + 10}s infinite ease-in-out;
            animation-delay: ${Math.random() * 5}s;
            filter: blur(${Math.random() * 3 + 1}px);
            transform: rotate(${Math.random() * 360}deg);
            ${shape === 'triangle' ? 'clip-path: polygon(50% 0%, 0% 100%, 100% 100%);' : ''}
        `;
        
        container.appendChild(particle);
    }
}

// âœ… LUXURY THEME INITIALIZATION
function initLuxuryTheme() {
    console.log("ğŸ’ Initializing Blue & Mint Luxury Theme...");
    
    createLuxuryParticles();
    updateGlobalUserStatus();
    
    // Enhanced hover effects
    document.querySelectorAll('.glass-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-10px) scale(1.02)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
    
    // Luxury click effects
    document.addEventListener('click', function(e) {
        if (e.target.tagName === 'BUTTON') {
            const btn = e.target;
            
            // Ripple effect
            const ripple = document.createElement('span');
            const rect = btn.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height) * 1.5;
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
                transform: scale(0);
                animation: luxury-ripple 0.8s ease-out;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                pointer-events: none;
            `;
            
            btn.style.position = 'relative';
            btn.style.overflow = 'hidden';
            btn.appendChild(ripple);
            
            setTimeout(() => ripple.remove(), 800);
            
            // Particle burst
            createClickParticles(e.clientX, e.clientY);
        }
    });
}

// Luxury ripple animation
const luxuryStyle = document.createElement('style');
luxuryStyle.textContent = `
    @keyframes luxury-ripple {
        0% {
            transform: scale(0);
            opacity: 1;
        }
        100% {
            transform: scale(4);
            opacity: 0;
        }
    }
    
    @keyframes click-particle {
        0% {
            transform: translate(0, 0) scale(1);
            opacity: 1;
        }
        100% {
            transform: translate(var(--tx), var(--ty)) scale(0);
            opacity: 0;
        }
    }
`;
document.head.appendChild(luxuryStyle);

function createClickParticles(x, y) {
    const container = document.getElementById('luxury-particles');
    const colors = ['#667eea', '#4ECDC4', '#FFD700'];
    
    for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        const size = Math.random() * 8 + 4;
        const color = colors[Math.floor(Math.random() * colors.length)];
        const angle = (Math.PI * 2 * i) / 8;
        const distance = Math.random() * 50 + 30;
        
        particle.style.cssText = `
            position: fixed;
            background: ${color};
            width: ${size}px;
            height: ${size}px;
            border-radius: 50%;
            left: ${x}px;
            top: ${y}px;
            --tx: ${Math.cos(angle) * distance}px;
            --ty: ${Math.sin(angle) * distance}px;
            animation: click-particle 0.6s ease-out forwards;
            z-index: 10000;
        `;
        
        document.body.appendChild(particle);
        setTimeout(() => particle.remove(), 600);
    }
}

// Initialize when loaded
document.addEventListener('DOMContentLoaded', initLuxuryTheme);



// âœ… REGISTER SERVICE WORKER (tambahkan di awal file JavaScript)
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js')
      .then(registration => {
        console.log('âœ… ServiceWorker registration successful');
      })
      .catch(error => {
        console.log('âŒ ServiceWorker registration failed: ', error);
      });
  });
}

// Override dengan styling tema neon Anda
window.alert = (msg) => Swal.fire({
    title: 'â„¹ Info',
    text: msg,
    icon: 'info',
    confirmButtonText: 'OK',
    background: 'linear-gradient(145deg, #2d6a4f, #40916c)', // âœ… HIJAU TERANG
    color: '#ffffff',
    confirmButtonColor: '#ff416c',
    width: '300px',
    padding: '1.2rem',
    backdrop: 'rgba(0, 0, 0, 0.5)',
    customClass: {
        popup: 'custom-swal-popup',
        title: 'custom-swal-title',
        htmlContainer: 'custom-swal-text'
    }
});

window.confirm = (msg) => Swal.fire({
    title: 'â“ Konfirmasi', 
    text: msg, 
    icon: 'question', 
    showCancelButton: true,
    confirmButtonText: 'Ya',
    cancelButtonText: 'Tidak',
    background: 'linear-gradient(145deg, #2d6a4f, #40916c)', // âœ… HIJAU TERANG
    color: '#ffffff',
    confirmButtonColor: '#ff416c',
    cancelButtonColor: '#6c757d',
    width: '80px',
    padding: '1.2rem',
    backdrop: 'rgba(0, 0, 0, 0.5)',
    customClass: {
        popup: 'custom-swal-popup',
        title: 'custom-swal-title', 
        htmlContainer: 'custom-swal-text'
    }
}).then(result => result.isConfirmed);

// Fungsi untuk menampilkan section tertentu
function showSection(sectionId) {
    console.log("ğŸ”„ Menampilkan section:", sectionId);
    
    // Sembunyikan semua section utama
    const sectionsToHide = ["dashboard", "photobooth-section", "pembayaran-section", "paket-section"];
    sectionsToHide.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = "none";
            console.log("âŒ Sembunyikan:", id);
        }
    });
    
    // Sembunyikan semua content section sidebar
    const sections = document.querySelectorAll(".contentSection");
    sections.forEach(sec => {
        sec.style.display = "none";
        console.log("âŒ Sembunyikan sidebar section:", sec.id);
    });
    
    // Tampilkan section yang dipilih
    if (sectionId === "dashboard") {
        document.getElementById("dashboard").style.display = "block";
        console.log("âœ… Tampilkan: dashboard");
    } else if (sectionId === "photobooth") {
        if (!paketActive) {
            alert("Silakan pilih paket terlebih dahulu.");
            document.getElementById("dashboard").style.display = "block";
            return;
        }
        document.getElementById("photobooth-section").style.display = "block";
        console.log("âœ… Tampilkan: photobooth-section");
        mulaiTimerPaket();
    } else if (sectionId === "pembayaran") {
        document.getElementById("pembayaran-section").style.display = "block";
        console.log("âœ… Tampilkan: pembayaran-section");
    } else if (sectionId === "paket") {
        document.getElementById("paket-section").style.display = "block";
        console.log("âœ… Tampilkan: paket-section");
    } else {
        // Untuk section sidebar (filesContent, guideContent, aboutContent)
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.style.display = "block";
            console.log("âœ… Tampilkan sidebar section:", sectionId);
            console.log("ğŸ“ Posisi:", targetSection.getBoundingClientRect());
            console.log("ğŸ¨ Style display:", window.getComputedStyle(targetSection).display);
            
            // Force redraw dan beri border debug
            targetSection.style.border = "3px solid #00ff00";
            targetSection.style.background = "rgba(0,255,0,0.1)";
        } else {
            console.error("âŒ Section tidak ditemukan:", sectionId);
        }
    }
}

// ===== VARIABLES & FUNGSI CAMERA =====
const video = document.getElementById('video');  
const canvas = document.getElementById('canvas');  
const frameOverlay = document.getElementById('frame-overlay');  
const countdownEl = document.getElementById('countdown');  
const startBtn = document.getElementById('startBtn');  
const stopBtn = document.getElementById('stopBtn');  
const captureBtn = document.getElementById('captureBtn');  
const deleteBtn = document.getElementById('deleteBtn');  
const timerSelect = document.getElementById('timerSelect');  
const filterSelect = document.getElementById('filterSelect');  
const gallery = document.getElementById('gallery');  
const videoBtn = document.getElementById('videoBtn');  
const videoControlsContainer = document.getElementById('videoControls');  
const startRecBtn = document.getElementById('startRecBtn');  
const stopRecBtn = document.getElementById('stopRecBtn');  
const pauseRecBtn = document.getElementById('pauseRecBtn');  
const prevBtn = document.getElementById('prevBtn');  
const nextBtn = document.getElementById('nextBtn');  
const videoTimerEl = document.getElementById('videoTimer');  
const frameSelect = document.getElementById('frameSelect');
const downloadBtn = document.getElementById('downloadBtn');
const printBtn = document.getElementById('printBtn');
const menuHome = document.getElementById('menuHome');

let lastCapturedData = null;
let fotoSiap = false;
let paketActive = false;
let paketDuration = 0;
let paketTimer = null;
let waktuSisa = 0;
let kameraAktif = false; 
let timerPaused = true;  
let startTime = null;    
let elapsedTime = 0; 
let stream = null;  
let currentFrame = "";  
let audioEnabled = false;  
let galleryImages = [];  
let currentIndex = 0;  
let showingPhoto = false;  
let isPreviewActive = false; 
let mediaRecorder = null;  
let recordedChunks = [];  
let videoTimerInterval = null;  
let videoStartTime = null;
let homeClickTimer = null; 
let sidebar = null;
let hamburgerMenu = null;
let isSidebarOpen = true;
let pembayaranVerified = false;
let currentUser = null;
let currentBuktiData = null;
let menuHubungi = null;
let paketFotoLimit = 0;
let paketVideoLimit = 0;

// ğŸ¯ FUNGSI KOMPRESI GAMBAR UNTUK UKURAN LEBIH KECIL
function compressImage(dataUrl, quality = 0.6) {
    return new Promise((resolve) => {
        const img = new Image();
        img.src = dataUrl;
        
        img.onload = function() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // ğŸ¯ UKURAN LEBIH KECIL UNTUK KOMPRESI
            const maxWidth = 800;
            const maxHeight = 600;
            
            let width = img.width;
            let height = img.height;
            
            if (width > height) {
                if (width > maxWidth) {
                    height = Math.round((height * maxWidth) / width);
                    width = maxWidth;
                }
            } else {
                if (height > maxHeight) {
                    width = Math.round((width * maxHeight) / height);
                    height = maxHeight;
                }
            }
            
            canvas.width = width;
            canvas.height = height;
            
            ctx.drawImage(img, 0, 0, width, height);
            
            // ğŸ¯ KOMPRESI DENGAN QUALITY LEBIH RENDAH
            const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
            resolve(compressedDataUrl);
        };
        
        img.onerror = function() {
            // ğŸ¯ JIKA KOMPRESI GAGAL, PAKAI DATA ASLI
            resolve(dataUrl);
        };
    });
}

// ğŸ¯ FUNGSI SIMPAN DATA DENGAN KOMPRESI & MANAGEMENT
async function enhancedSaveUserData() {
    if (!currentUser) {
        console.error("âŒ Tidak ada user yang login");
        return false;
    }

    try {
        // ğŸ¯ LIMIT JUMLAH ITEM DI GALLERY UNTUK HEMAT STORAGE
        const MAX_GALLERY_ITEMS = 15;
        
        if (currentUser.gallery && currentUser.gallery.length > MAX_GALLERY_ITEMS) {
            // ğŸ¯ SIMPAN HANYA ITEM TERBARU
            currentUser.gallery = currentUser.gallery.slice(-MAX_GALLERY_ITEMS);
            console.log(`ğŸ¯ Gallery dibatasi ${MAX_GALLERY_ITEMS} item terbaru`);
        }

        const userDataStr = JSON.stringify(currentUser);
        const dataSize = new Blob([userDataStr]).size;
        
        console.log('ğŸ’¾ Ukuran data:', (dataSize / 1024 / 1024).toFixed(2), 'MB');

        // ğŸ¯ CEK JIKA UKURAN MASIH TERLALU BESAR
        if (dataSize > 4000000) { // 4MB
            console.warn("âš  Data hampir penuh, kompresi gallery...");
            await compressGalleryData();
            return await retrySaveUserData();
        }

        // ğŸ¯ SIMPAN KE STORAGE
        localStorage.setItem('user_' + currentUser.email, userDataStr);
        localStorage.setItem('currentUser', userDataStr);
        
        console.log("âœ… Data user berhasil disimpan permanen");
        return true;

    } catch (error) {
        console.error("ğŸ’¥ Gagal menyimpan data:", error);
        
        // ğŸ¯ CLEANUP & RETRY
        if (await emergencyStorageCleanup()) {
            return await retrySaveUserData();
        }
        showStorageError();
        return false;
    }
}

// ğŸ¯ FUNGSI KOMPRESI GALLERY DATA
async function compressGalleryData() {
    if (!currentUser || !currentUser.gallery) return;
    
    console.log("ğŸ¯ Melakukan kompresi gallery data...");
    
    for (let i = 0; i < currentUser.gallery.length; i++) {
        const item = currentUser.gallery[i];
        
        // ğŸ¯ KOMPRESI HANYA FOTO (VIDEO TIDAK PERLU BASE64)
        if (item.type === 'photo' && item.data && item.data.startsWith('data:image')) {
            try {
                // ğŸ¯ KOMPRESI GAMBAR DENGAN QUALITY RENDAH
                const compressedData = await compressImage(item.data, 0.5);
                item.data = compressedData;
                item.compressed = true;
                
                console.log(`ğŸ¯ Foto ${i+1} dikompresi`);
            } catch (e) {
                console.warn(`âš  Gagal kompresi foto ${i+1}:`, e);
            }
        }
        
        // ğŸ¯ HAPUS DATA VIDEO YANG BESAR (SIMPAN HANYA URL BLOB)
        if (item.type === 'video' && item.data && item.data.startsWith('blob:')) {
            // Video blob URL tidak bisa disimpan permanen, jadi kita skip
            // Atau konversi ke format yang lebih kecil
            item.data = ''; // Kosongkan data video besar
            item.videoUrl = 'session_only'; // Tandai sebagai session only
        }
    }
    
    // ğŸ¯ HAPUS ITEM TERLAMA JIKA MASIH BESAR
    if (currentUser.gallery.length > 10) {
        currentUser.gallery = currentUser.gallery.slice(-10);
        console.log("ğŸ¯ Hapus item terlama, simpan 10 terbaru");
    }
}

// ğŸ¯ FUNGSI LOAD USER DATA YANG ROBUST
function loadUserData() {
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        try {
            currentUser = JSON.parse(savedUser);
            
            // ğŸ¯ INISIALISASI JIKA DATA TIDAK LENGKAP
            if (!currentUser.gallery) currentUser.gallery = [];
            if (!currentUser.fotoTerambil) currentUser.fotoTerambil = 0;
            if (!currentUser.videoTerambil) currentUser.videoTerambil = 0;
            if (!currentUser.paket) currentUser.paket = null;
            if (!currentUser.waktuSisa) currentUser.waktuSisa = 0;
            
            // ğŸ¯ LOAD GALLERY KE MEMORY
            galleryImages = [...currentUser.gallery];
            
            console.log(`âœ… User data loaded: ${currentUser.gallery.length} items di gallery`);
            return true;
            
        } catch (e) {
            console.error("âŒ Error loading user data:", e);
            return false;
        }
    }
    return false;
}

// Fungsi bantu untuk error storage
function showStorageError() {
    Swal.fire({
        title: 'ğŸ’¾ Penyimpanan Penuh',
        html: `
        <div style="text-align: left;">
            <p><strong>Penyimpanan perangkat hampir penuh!</strong></p>
            <p>Beberapa foto/video mungkin tidak tersimpan permanen.</p>
            <p>Silakan hapus beberapa hasil lama atau download ke perangkat Anda.</p>
        </div>
        `,
        icon: 'warning',
        confirmButtonText: 'Mengerti'
    });
}

// ==================== FUNGSI BARU ====================
async function aggressiveCleanup() {
    if (!currentUser || !currentUser.gallery) return;
    
    console.log("ğŸ§¹ Melakukan aggressive cleanup...");
    
    // Urutkan dari yang paling lama
    currentUser.gallery.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
    
    // Simpan hanya 8 item terbaru (bisa disesuaikan)
    const itemsToKeep = 8;
    if (currentUser.gallery.length > itemsToKeep) {
        const deletedCount = currentUser.gallery.length - itemsToKeep;
        currentUser.gallery = currentUser.gallery.slice(-itemsToKeep);
        console.log(`ğŸ—‘ Dihapus ${deletedCount} item terlama`);
    }
    
    // Juga hapus galleryImages yang sesuai
    galleryImages = [...currentUser.gallery];
    
    // Reload gallery UI
    loadUserGallery();
    
    showFeedback("ğŸ§¹ Penyimpanan dibersihkan untuk menghemat space");
}

// ğŸ¯ EMERGENCY CLEANUP YANG PINTAR
async function emergencyStorageCleanup() {
    try {
        console.log("ğŸš¨ SMART STORAGE CLEANUP!");
        
        // ğŸ¯ 1. HAPUS DATA USER LAMA
        const currentUserEmail = currentUser ? currentUser.email : '';
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('user_') && !key.includes(currentUserEmail)) {
                localStorage.removeItem(key);
                console.log("ğŸ—‘ Hapus data user lama:", key);
            }
        }
        
        // ğŸ¯ 2. KOMPRESI GALLERY CURRENT USER
        if (currentUser && currentUser.gallery) {
            await compressGalleryData();
            
            // ğŸ¯ 3. HAPUS 50% ITEM TERLAMA JIKA MASIH BESAR
            if (currentUser.gallery.length > 8) {
                const keepCount = Math.floor(currentUser.gallery.length * 0.5);
                currentUser.gallery = currentUser.gallery.slice(-keepCount);
                galleryImages = [...currentUser.gallery];
                console.log(`ğŸ¯ Hapus 50% item terlama, simpan ${keepCount} terbaru`);
            }
        }
        
        console.log("âœ… Smart cleanup completed");
        return true;
        
    } catch (e) {
        console.error("âŒ Gagal smart cleanup:", e);
        return false;
    }
}

// âœ… INISIALISASI SIDEBAR
function initSidebar() {
    sidebar = document.getElementById('sidebar');
    hamburgerMenu = document.getElementById('hamburger-menu');
    menuHubungi = document.getElementById('menuHubungi'); // âœ… TAMBAH INI
    
    if (sidebar && hamburgerMenu) {
        console.log("âœ… Sidebar dan hamburger menu berhasil diinisialisasi");
        updateSidebarState();
        hamburgerMenu.addEventListener('click', toggleSidebar);
        document.addEventListener('click', closeSidebarOnClickOutside);
        
        // âœ… TAMBAHKAN EVENT LISTENER UNTUK MENU HUBUNGI KAMI
        if (menuHubungi) {
            menuHubungi.addEventListener('click', function() {
                console.log("ğŸ¯ Menu Hubungi Kami diklik!");
                hubungiKami();
                closeSidebar();
            });
            console.log("âœ… Event listener Hubungi Kami berhasil dipasang");
        } else {
            console.error("âŒ Element menuHubungi tidak ditemukan");
        }
        
    } else {
        console.error("âŒ Element sidebar atau hamburger menu tidak ditemukan");
    }
}


// âœ… TOGGLE SIDEBAR
function toggleSidebar(event) {
    if (event) event.stopPropagation();
    
    if (isSidebarOpen) {
        closeSidebar();
    } else {
        openSidebar();
    }
}

// âœ… BUKA SIDEBAR
function openSidebar() {
    if (sidebar) {
        sidebar.classList.remove('sidebar-closed');
        sidebar.classList.add('sidebar-open');
        isSidebarOpen = true;
        console.log("ğŸ”“ Sidebar dibuka");
    }
}

// âœ… TUTUP SIDEBAR
function closeSidebar() {
    if (sidebar) {
        sidebar.classList.remove('sidebar-open');
        sidebar.classList.add('sidebar-closed');
        isSidebarOpen = false;
        console.log("ğŸ”’ Sidebar ditutup");
    }
}

// âœ… TUTUP SIDEBAR KETIKA KLIK DI LUAR
function closeSidebarOnClickOutside(event) {
    if (!isSidebarOpen) return;
    
    const isClickInsideSidebar = sidebar.contains(event.target);
    const isClickOnHamburger = hamburgerMenu.contains(event.target);
    
    if (!isClickInsideSidebar && !isClickOnHamburger) {
        closeSidebar();
    }
}

// âœ… UPDATE STATE SIDEBAR BERDASARKAN HALAMAN
function updateSidebarState() {
    const currentSection = getCurrentSection();
    console.log("ğŸ“ Current section:", currentSection);
    
    if (currentSection === 'dashboard') {
        // ğŸ  HALAMAN UTAMA: Sidebar terbuka, hamburger TAMPIL
        openSidebar();
        if (hamburgerMenu) {
            hamburgerMenu.style.display = 'block';
            console.log("ğŸ  Halaman utama - Sidebar terbuka, hamburger tampil");
        }
    } else {
        // ğŸ“± HALAMAN LAIN: Sidebar tertutup, hamburger TAMPIL
        closeSidebar();
        if (hamburgerMenu) {
            hamburgerMenu.style.display = 'block';
            console.log("ğŸ“± Halaman lain - Sidebar tertutup, hamburger tampil");
        }
    }
}

// âœ… DETEKSI HALAMAN AKTIF
function getCurrentSection() {
    if (document.getElementById('dashboard').style.display !== 'none') return 'dashboard';
    if (document.getElementById('photobooth-section').style.display !== 'none') return 'photobooth';
    if (document.getElementById('pembayaran-section').style.display !== 'none') return 'pembayaran';
    if (document.getElementById('paket-section').style.display !== 'none') return 'paket';
    return 'dashboard';
}

frameSelect.addEventListener('change', () => {
  const selectedFrame = frameSelect.value;
  if (!selectedFrame) {
    frameOverlay.style.display = 'none';
    currentFrame = "";
  } else {
    currentFrame = selectedFrame;
    frameOverlay.src = selectedFrame;
    frameOverlay.style.display = 'block';
  }
});  
// Mulai timer video  
// Mulai timer video
function startVideoTimer() {  
  videoTimerEl.style.display = 'block';  
  videoStartTime = Date.now();  
  videoTimerInterval = setInterval(updateVideoTimer, 500);  
}

// Hentikan timer video
function stopVideoTimer() {  
  clearInterval(videoTimerInterval);  
  videoTimerEl.style.display = 'none';  
}

// Jeda timer video
function pauseVideoTimer() {  
  if (videoTimerInterval) clearInterval(videoTimerInterval);  
  if (videoStartTime) {
    videoPausedTime = Date.now() - videoStartTime; // simpan durasi saat pause
  }
}

// Lanjutkan timer video setelah pause
function resumeVideoTimer() {  
  if (videoPausedTime == null) return;  
  videoStartTime = Date.now() - videoPausedTime; // hitung offset
  videoTimerInterval = setInterval(updateVideoTimer, 500);
}

// Fungsi pembaruan tampilan timer
function updateVideoTimer() {
  const diff = Math.floor((Date.now() - videoStartTime) / 1000);  
  const h = Math.floor(diff / 3600).toString().padStart(2,'0');  
  const m = Math.floor((diff % 3600 / 60)).toString().padStart(2,'0');  
  const s = (diff % 60).toString().padStart(2,'0');  
  videoTimerEl.textContent = `${h}:${m}:${s}`;
}

// --- FUNGSI addToGallery() DENGAN SCROLL OTOMATIS ---
async function addToGallery(item) {
    const index = galleryImages.length;

    let finalData = item;
    let compressed = false;

    // KOMPRESI OTOMATIS JIKA FOTO
    if (item.startsWith('data:image')) {
        try {
            finalData = await compressImage(item, 0.7);
            compressed = true;
            console.log("ğŸ¯ Foto dikompresi otomatis");
        } catch (e) {
            console.warn("âš  Gagal kompresi, pakai data asli");
            finalData = item;
        }
    }

    // SIMPAN DATA FOTO
    const photoItem = {
        id: 'photo_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
        data: finalData,
        type: 'photo',
        frame: currentFrame,
        timestamp: new Date().toISOString(),
        storageType: 'base64',
        compressed: compressed
    };

    galleryImages.push(photoItem);

    const thumb = document.createElement('img');
    thumb.className = "thumb";
    thumb.src = finalData;
    thumb.setAttribute('data-id', photoItem.id);
    thumb.onclick = () => {
        currentIndex = index;
        showingPhoto = true;
        showOnCamera(index);
    };

    // STYLE THUMBNAIL
    thumb.style.width = "140px";
    thumb.style.height = "105px";
    thumb.style.objectFit = "cover";
    thumb.style.borderRadius = "12px";
    thumb.style.flexShrink = "0";
    thumb.style.display = "block";

    // TAMBAH KE GALLERY
    gallery.appendChild(thumb);

    // SIMPAN KE USER PROFILE
    if (currentUser) {
        if (!currentUser.gallery) currentUser.gallery = [];

        const isDuplicate = currentUser.gallery.some(existingItem =>
            existingItem.id === photoItem.id
        );
        if (!isDuplicate) {
            currentUser.gallery.push(photoItem);
            currentUser.fotoTerambil++;
            
            enhancedSaveUserData().then(success => {
                if (success) {
                    console.log("âœ… Foto disimpan permanen");
                }
            });
        }
    }

    updatePackageCounter();

    // ğŸ¯ SCROLL OTOMATIS KE FOTO BARU - PASTI SAMPAI UJUNG
    setTimeout(() => {
        const gallery = document.getElementById('gallery');
        if (gallery) {
            // ğŸ¯ SCROLL PASTI KE UJUNG PALING KANAN
            gallery.scrollTo({
                left: gallery.scrollWidth,
                behavior: 'smooth'
            });
            
            // ğŸ¯ UPDATE TOMBOL SETELAH SCROLL
            setTimeout(() => {
                updateScrollButtons();
                console.log('ğŸ  Auto-scroll ke ujung kanan');
            }, 400);
        }
    }, 300);
}

// ==================== FUNGSI addVideoToGallery() TANPA BATASAN ====================
function addVideoToGallery(videoURL) {
    const index = galleryImages.length;

    const videoItem = {
        id: 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
        data: videoURL,
        type: 'video',
        frame: currentFrame,
        timestamp: new Date().toISOString(),
        storageType: 'blob'
    };

    galleryImages.push(videoItem);

    const videoContainer = document.createElement('div');
    videoContainer.setAttribute('data-id', videoItem.id);

    // âœ… STYLE CONTAINER
    videoContainer.style.width = "120px";
    videoContainer.style.height = "90px";
    videoContainer.style.borderRadius = "12px";
    videoContainer.style.overflow = "hidden";
    videoContainer.style.flexShrink = "0";
    videoContainer.style.display = "block";
    videoContainer.style.position = "relative";

    const vid = document.createElement('video');
    vid.src = videoURL;
    vid.className = "thumb";
    vid.muted = true;
    vid.loop = true;
    vid.autoplay = true;
    vid.style.transform = "scaleX(1)";
    vid.controls = false;

    // âœ… STYLE VIDEO
    vid.style.width = "100%";
    vid.style.height = "100%";
    vid.style.objectFit = "cover";
    vid.style.borderRadius = "12px";

    // âœ… CONTROLS OVERLAY
    const controlsOverlay = document.createElement('div');
    controlsOverlay.style.position = 'absolute';
    controlsOverlay.style.bottom = '5px';
    controlsOverlay.style.left = '5px';
    controlsOverlay.style.right = '5px';
    controlsOverlay.style.background = 'rgba(0,0,0,0.7)';
    controlsOverlay.style.borderRadius = '8px';
    controlsOverlay.style.padding = '4px';
    controlsOverlay.style.display = 'flex';
    controlsOverlay.style.alignItems = 'center';
    controlsOverlay.style.gap = '6px';
    controlsOverlay.style.fontSize = '10px';
    controlsOverlay.style.color = 'white';

    const playBtn = document.createElement('button');
    playBtn.innerHTML = 'â–¶';
    playBtn.style.background = 'none';
    playBtn.style.border = 'none';
    playBtn.style.color = 'white';
    playBtn.style.cursor = 'pointer';
    playBtn.style.fontSize = '10px';

    const timeDisplay = document.createElement('span');
    timeDisplay.textContent = '0:00';

    controlsOverlay.appendChild(playBtn);
    controlsOverlay.appendChild(timeDisplay);

    videoContainer.appendChild(vid);
    videoContainer.appendChild(controlsOverlay);

    // âœ… EVENT LISTENERS
    playBtn.onclick = (e) => {
        e.stopPropagation();
        if (vid.paused) {
            vid.play();
            playBtn.innerHTML = 'âšâš';
        } else {
            vid.pause();
            playBtn.innerHTML = 'â–¶';
        }
    };

    vid.ontimeupdate = () => {
        const minutes = Math.floor(vid.currentTime / 60);
        const seconds = Math.floor(vid.currentTime % 60);
        timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    };

    videoContainer.onclick = () => {
        currentIndex = index;
        showVideoOnCamera(videoURL, true);
    };

    // âœ… TAMBAH KE GALLERY - TANPA BATASAN
    gallery.appendChild(videoContainer);

    // ğŸ¯ SIMPAN KE USER PROFILE
    if (currentUser) {
        if (!currentUser.gallery) currentUser.gallery = [];

        const isDuplicate = currentUser.gallery.some(existingItem =>
            existingItem.id === videoItem.id
        );
        if (!isDuplicate) {
            currentUser.gallery.push(videoItem);
            currentUser.videoTerambil++;
            
            enhancedSaveUserData().then(success => {
                if (success) {
                    console.log("âœ… Video metadata disimpan permanen");
                }
            });
        }
    }

    updatePackageCounter();

    // SCROLL KE THUMBNAIL BARU
    setTimeout(() => {
        const gallery = document.getElementById('gallery');
        if (gallery) {
            gallery.scrollLeft = gallery.scrollWidth;
            setTimeout(updateScrollButtons, 100);
        }
    }, 200);
}

// ğŸ”Š Bunyi timer  
function playBeep() {  
  if (!audioEnabled) return;  
  const ctx = new AudioContext();  
  const osc = ctx.createOscillator();  
  osc.type = "square";  
  osc.frequency.value = 800;  
  const gain = ctx.createGain();  
  gain.gain.value = 0.1;  
  osc.connect(gain);  
  gain.connect(ctx.destination);  
  osc.start();  
  osc.stop(ctx.currentTime + 0.1);  
}  
  
// ğŸ”Š Suara jepret  
function playShutter() {  
  if (!audioEnabled) return;  
  const shutterSound = new Audio("camera-13695.mp3");
  shutterSound.play().catch(err => console.warn("Gagal memutar suara jepret:", err));  
}  
  
async function startCamera() {
    try {
        const constraints = {
            video: {
                width: { ideal: 1280 },
                height: { ideal: 720 },
                facingMode: 'user'
            },
            audio: false
        };

        stream = await navigator.mediaDevices.getUserMedia(constraints);

        video.srcObject = stream;
        video.style.display = 'block';
        canvas.style.display = 'none';
        
        canvas.width = 1280;
        canvas.height = 720;

        if (currentFrame !== "") {
            frameOverlay.style.display = 'block';
            frameOverlay.style.transform = "scaleX(-1)";
        }

        audioEnabled = true;
        showingPhoto = false;
        video.style.filter = filterSelect.value || "none";
        videoControlsContainer.style.display = 'none';
        
        console.log("ğŸ“· Kamera berhasil dinyalakan");

        // âœ… TIMER: MULAI JALANKAN TIMER KETIKA KAMERA AKTIF
        if (paketActive && timerPaused) {
            mulaiTimerPaket();
            kameraAktif = true;
            timerPaused = false;
            console.log("â± Timer paket dimulai (kamera aktif)");
        }

    } catch (err) {
        alert("Tidak dapat mengakses kamera: " + err);
    }
}

function stopCamera() {
    // âœ… TIMER: PAUSE TIMER KETIKA KAMERA DIMATIKAN
    if (paketActive && !timerPaused) {
        pauseTimerPaket();
        kameraAktif = false;
        timerPaused = true;
        console.log("â¸ Timer paket di-pause (kamera non-aktif)");
    }

    if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
    }

    video.srcObject = null;
    video.src = "";
    video.pause();
    video.style.display = 'none';
    canvas.style.display = 'none';
    frameOverlay.style.display = 'none';
    videoControlsContainer.style.display = 'none';
    videoTimerEl.style.display = 'none';
    stopVideoTimer();
    //gallery.style.display = 'flex';
    
    startRecBtn.style.display = 'none';
    pauseRecBtn.style.display = 'none';
    stopRecBtn.style.display = 'none';
    if (typeof resumeRecBtn !== 'undefined')
        resumeRecBtn.style.display = 'none';

    console.log("ğŸ“· Kamera dimatikan, timer di-pause");
}

function showCameraContainer() {
    const cameraContainer = document.getElementById('camera-container');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    
    if (cameraContainer) {
        cameraContainer.style.display = 'inline-block';
        console.log("  Container kamera ditampilkan (dalam keadaan mati)");
    }
    
    // Pastikan video dan canvas disembunyikan awalnya
    if (video) {
        video.style.display = 'none';
        video.srcObject = null;
    }
    if (canvas) {
        canvas.style.display = 'none';
    }
    
    // Sembunyikan kontrol video
    const videoControlsContainer = document.getElementById('videoControls');
    if (videoControlsContainer) {
        videoControlsContainer.style.display = 'none';
    }
    
    // Sembunyikan countdown dan timer
    const countdown = document.getElementById('countdown');
    const videoTimer = document.getElementById('videoTimer');
    if (countdown) countdown.style.display = 'none';
    if (videoTimer) videoTimer.style.display = 'none';
    
    // Tampilkan frame overlay jika ada frame yang dipilih
    const frameOverlay = document.getElementById('frame-overlay');
    if (frameOverlay && currentFrame !== "") {
        frameOverlay.style.display = 'block';
        frameOverlay.src = currentFrame;
    } else if (frameOverlay) {
        frameOverlay.style.display = 'none';
    }
    
    // Reset state
    showingPhoto = false;
    isPreviewActive = false;
    
    // Tampilkan gallery
    const gallery = document.getElementById('gallery');
    if (gallery) {
        gallery.style.display = 'flex';
    }
}
  
// ğŸ“¸ Ambil foto                                                                                 capture
function capturePhoto() {
    // âœ… CEK LIMIT FOTO UNTUK SEMUA PAKET (TRIAL, BASIC, PREMIUM, VIP)
    if (currentUser && currentUser.paket) {
        if (currentUser.fotoTerambil >= currentUser.paketFotoLimit) {
            let pesan = '';
            if (currentUser.paket === "Trial") {
                pesan = 'Upgrade ke paket berbayar untuk foto unlimited!';
            } else if (currentUser.paket === "VIP") {
                pesan = 'Paket VIP Anda sudah mencapai batas foto.';
            } else {
                pesan = 'Anda sudah mencapai batas foto untuk paket ' + currentUser.paket;
            }
            
            Swal.fire({
                title: 'âŒ Limit Foto Habis',
                html: `
                    <div style="text-align: left; margin: 15px 0;">
                        <p><strong>Anda sudah mencapai batas foto untuk paket ${currentUser.paket}!</strong></p>
                        <p>ğŸ“¸ <strong>${currentUser.fotoTerambil}/${currentUser.paketFotoLimit}</strong> foto sudah diambil</p>
                        <p>â± Sisa waktu: <strong>${formatTime(currentUser.waktuSisa)}</strong></p>
                        <br>
                        <p>ğŸ’¡ <em>${pesan}</em></p>
                    </div>
                `,
                icon: 'warning',
                confirmButtonText: 'Mengerti',
                background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
                color: '#ffffff',
                confirmButtonColor: '#ff416c',
                width: '450px'
            });
            return;
        }
    }

    const ctx = canvas.getContext('2d');
    canvas.width = video.videoWidth || 1280;
    canvas.height = video.videoHeight || 720;

    ctx.save();

    // Terapkan filter sebelum menggambar video agar hasil foto ikut filter
    ctx.filter = filterSelect.value || "none";

    // Balik kamera (mirror)
    ctx.scale(-1, 1);
    ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);

    ctx.restore();

    // Suara jepretan
    playShutter();

    const finalizeCapture = (imageData) => {
    // Set data foto dan flag siap simpan
    lastCapturedData = imageData;
    fotoSiap = true;
    console.log(" âœ… Foto diambil, data tersimpan:", !!lastCapturedData);

    // âœ… LANGSUNG SIMPAN KE GALLERY DENGAN ID UNIK
    addToGallery(imageData);

    // UPDATE COUNTER FOTO UNTUK SEMUA PAKET
    if (currentUser && currentUser.paket) {
        currentUser.fotoTerambil++;
        
        // âœ… SIMPAN PERUBAHAN COUNTER
        try {
            localStorage.setItem('user_' + currentUser.email, JSON.stringify(currentUser));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
        } catch (e) {
            console.error(" âŒ Gagal menyimpan counter:", e);
            cleanupLocalStorage();
        }

        console.log(` âœ… Progress ${currentUser.paket}: ${currentUser.fotoTerambil}/${currentUser.paketFotoLimit} foto`);
        
        // âœ… TAMPILKAN NOTIFIKASI PROGRESS
        if (currentUser.fotoTerambil === currentUser.paketFotoLimit) {
            if (currentUser.paket === "VIP") {
                showFeedback(" ğŸ‰ Batas foto VIP tercapai!");
            } else {
                showFeedback(" âš  Foto terpakai!");
            }
        } else {
            showFeedback(` ğŸ“¸ Foto ${currentUser.fotoTerambil}/${currentUser.paketFotoLimit}`);
        }
    }
   canvas.style.display = 'block';

        if (currentFrame !== "") {
            frameOverlay.style.display = 'block';
        } else {
            frameOverlay.style.display = 'none';
        }

        canvas.classList.add('float-shrink-hold');

        canvas.addEventListener('animationend', function handler() {
            canvas.classList.remove('float-shrink-hold');
            canvas.style.display = 'none';
            canvas.removeEventListener('animationend', handler);
        });
    };

    if (currentFrame !== "") {
        // Jika frame aktif, gabungkan frame ke foto
        const frame = new Image();
        frame.src = currentFrame;
        frame.onload = function() {
            ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
            const imageData = canvas.toDataURL("image/png");
            console.log("ğŸ–¼ Foto dengan frame disimpan:", !!imageData);
            finalizeCapture(imageData);
        };
    } else {
        // Tanpa frame tetap finalize
        const imageData = canvas.toDataURL("image/png");
        console.log("ğŸ–¼ Foto tanpa frame disimpan:", !!imageData);
        finalizeCapture(imageData);
    }
}

// ğŸ–¼ Tampilkan hasil foto/video di layar kamera  
function showOnCamera(index) {
  currentIndex = index;
  showingPhoto = true;

  // sembunyikan video saat menampilkan foto
  if (stream) video.style.display = 'none';

  const item = galleryImages[index];
  const ctx = canvas.getContext('2d');
  const img = new Image();
  img.src = item.data;

  img.onload = function() {
    canvas.width = video.videoWidth || 480;
    canvas.height = video.videoHeight || 360;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Flip horizontal agar efek cermin sama seperti saat pengambilan foto
    ctx.save();
    ctx.scale(-1, 1);
    ctx.drawImage(img, -canvas.width, 0, canvas.width, canvas.height);
    ctx.restore();

    // tampilkan frame yang tersimpan di foto tersebut
    if (item.frame) {
      const frameImg = new Image();
      frameImg.src = item.frame;
      frameImg.onload = () => {
        ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
      };
    }

    canvas.style.display = 'block';
    frameOverlay.style.display = 'none'; // jangan tampilkan frame global
  };

 // updateNavigationButtons();
}
  
function showVideoOnCamera(url, isPreview = false) {  
    video.pause();  
    video.srcObject = null;      
    video.src = url;  
    video.controls = true;  // âœ… TAMPILKAN KONTROL DEFAULT
    video.autoplay = true;  
    video.muted = false;  
    video.loop = false;  
    video.style.display = 'block';  
    video.style.transform = "scaleX(1)"; // âœ… VIDEO NORMAL (TIDAK MIRROR)
    canvas.style.display = 'none';  
    frameOverlay.style.display = 'none';  

    // âœ… HAPUS WRAPPER YANG MEMBUAT KONTROL TERBALIK
    let videoWrapper = document.getElementById('videoWrapper');
    if (videoWrapper) {
        videoWrapper.style.transform = "none"; // âœ… HAPUS TRANSFORM
        videoWrapper.remove(); // âœ… HAPUS WRAPPER SAMA SEKALI
    }

    if (isPreview) {  
        videoControlsContainer.style.display = 'none';  
        stopVideoTimer();  
    } else {  
        videoControlsContainer.style.display = 'flex';  
        startVideoTimer();  
    }  

    showingPhoto = false;
    isPreviewActive = isPreview;
}

function showNext(event) {  
  event.stopPropagation();  
  if (currentIndex < galleryImages.length - 1) {  
    currentIndex++;  
    showOnCamera(currentIndex);  
  }  
}  
  
// ğŸ”¹ Tombol kontrol video di dalam kamera  
videoBtn.onclick = async () => {
    if (!stream) {
        showCameraAlert("  Nyalakan kamera terlebih dahulu!");
        return;
    }

    await startCamera(); // Pastikan kamera aktif

    canvas.style.display = 'none';
    video.controls = false; //  SEMBUNYIKAN KONTROL SAAT MODE KAMERA
    showingPhoto = false;

    //  VIDEO LIVE: GUNAKAN MIRROR EFFECT
    video.style.transform = "scaleX(-1)";
    if(currentFrame !== "") {
        frameOverlay.style.display = 'block';
        frameOverlay.style.transform = "scaleX(-1)";
    } else {
        frameOverlay.style.display = 'none';
    }

    videoControlsContainer.style.display = 'flex';
    startRecBtn.style.display = 'inline-block';
    stopRecBtn.style.display = 'none';
    pauseRecBtn.style.display = 'none';
    stopVideoTimer();
};

// ==================== FUNGSI startRecording() LENGKAP YANG DIPERBAIKI ====================
async function startRecording() {
    // âœ… CEK LIMIT VIDEO UNTUK SEMUA PAKET
    if (currentUser && currentUser.paket) {
        if (currentUser.videoTerambil >= currentUser.paketVideoLimit) {
            let pesan = "";
            if (currentUser.paket === "Trial") {
                pesan = 'Upgrade ke paket berbayar untuk lebih banyak video!';
            } else if (currentUser.paket === "VIP") {
                pesan = 'Paket VIP Anda sudah mencapai batas video.';
            } else {
                pesan = 'Anda sudah mencapai batas video untuk paket ' + currentUser.paket;
            }

            Swal.fire({
                title: 'ğŸ¥ Limit Video Habis',
                html: `
                <div style="text-align: left; margin: 15px 0;">
                    <p><strong>Anda sudah mencapai batas video untuk paket ${currentUser.paket}!</strong></p>
                    <p>ğŸ¥ <strong>${currentUser.videoTerambil}/${currentUser.paketVideoLimit}</strong> video sudah diambil</p>
                    <br>
                    <p>ğŸ¥ <em>${pesan}</em></p>
                </div>
                `,
                icon: 'warning',
                confirmButtonText: 'Mengerti',
                background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
                color: '#ffffff',
                confirmButtonColor: '#ff416c',
                width: '450px'
            });
            return;
        }
    }

    if (!stream) return;

    recordedChunks = [];

    // âœ… AMBIL AUDIO DENGAN QUALITY RINGAN
    let audioStream = null;
    try {
        audioStream = await navigator.mediaDevices.getUserMedia({ 
            audio: {
                sampleRate: 22050, // âœ… TURUNKAN SAMPLE RATE
                channelCount: 1,   // âœ… MONO SAJA
                echoCancellation: true,
                noiseSuppression: true
            } 
        });
    } catch (err) {
        console.warn("Tidak dapat mengakses mikrofon: ", err);
    }

    // âœ… SET RECORDING QUALITY YANG LEBIH RINGAN
    const recordingCanvas = document.createElement('canvas');
    recordingCanvas.width = 640;   // âœ… RESOLUSI LEBIH KECIL (640x480)
    recordingCanvas.height = 480;  // âœ… DARI 1280x720 â†’ 640x480
    const rctx = recordingCanvas.getContext('2d');

    const filterValue = filterSelect.value || "none";
    let frameImage = null;
    let lastFrameSrc = "";

    const drawFrame = () => {
        if (!stream) return;

        rctx.clearRect(0, 0, recordingCanvas.width, recordingCanvas.height);
        rctx.filter = filterValue;
        
        // âœ… DRAW VIDEO KE CANVAS DENGAN UKURAN LEBIH KECIL
        rctx.drawImage(video, 0, 0, recordingCanvas.width, recordingCanvas.height);

        if (currentFrame && currentFrame !== lastFrameSrc) {
            frameImage = new Image();
            frameImage.src = currentFrame;
            lastFrameSrc = currentFrame;
            frameImage.onload = () => {
                rctx.drawImage(frameImage, 0, 0, recordingCanvas.width, recordingCanvas.height);
            };
        } else if (frameImage) {
            rctx.drawImage(frameImage, 0, 0, recordingCanvas.width, recordingCanvas.height);
        }

        requestAnimationFrame(drawFrame);
    };

    drawFrame();

    const canvasStream = recordingCanvas.captureStream(15); // âœ… TURUNKAN FPS (15 fps)

    const combinedStream = audioStream
        ? new MediaStream([...canvasStream.getVideoTracks(), ...audioStream.getAudioTracks()])
        : canvasStream;

    // âœ… SET DURASI REKAMAN MAX 15 DETIK UNTUK FILE LEBIH KECIL
    mediaRecorder = new MediaRecorder(combinedStream, { 
        mimeType: 'video/webm; codecs=vp9',
        videoBitsPerSecond: 1000000 // âœ… BITRATE LEBIH RENDAH (1 Mbps)
    });

    mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
    };

    mediaRecorder.onstop = async () => {
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        
        // âœ… SOLUSI: SIMPAN SEBAGAI BLOB URL, BUKAN BASE64
        const videoURL = URL.createObjectURL(blob);
        
        console.log("ğŸ¥ Video disimpan sebagai Blob URL, size:", blob.size, "bytes");
        
        // âœ… TAMPILKAN VIDEO DI GALLERY
        addVideoToGallery(videoURL);
        
        // âœ… UPDATE COUNTER & SIMPAN KE USER DATA (TANPA SIMPAN DATA BESAR)
        if (currentUser && currentUser.paket) {
            currentUser.videoTerambil++;
            if (!currentUser.gallery) currentUser.gallery = [];
            
            // âœ… SIMPAN HANYA METADATA, BUKAN DATA VIDEO
            const videoItem = {
                id: 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                data: videoURL, // âœ… SIMPAN BLOB URL UNTUK SESSION INI
                type: 'video',
                frame: currentFrame,
                timestamp: new Date().toISOString(),
                storageType: 'blob', // âœ… TANDAI SEBAGAI BLOB
                size: blob.size
            };
            
            currentUser.gallery.push(videoItem);
            
            // âœ… CLEANUP GALLERY JIKA TERLALU BANYAK
            if (currentUser.gallery.length > 10) {
                currentUser.gallery = currentUser.gallery.slice(-10);
                console.log("ğŸ§¹ Gallery dibersihkan, simpan 10 item terbaru");
            }

            // âœ… SIMPAN KE STORAGE (UKURAN SANGAT KECIL)
            enhancedSaveUserData().then(success => {
                if (success) {
                    console.log("âœ… Metadata video disimpan permanen");
                } else {
                    console.warn("âš  Gagal menyimpan metadata video");
                }
            });
            
            console.log(`ğŸ“Š Progress ${currentUser.paket}: ${currentUser.videoTerambil}/${currentUser.paketVideoLimit} video`);
            updatePackageCounter();
            
            if (currentUser.videoTerambil >= currentUser.paketVideoLimit) {
                showFeedback("ğŸ¥ Batas video tercapai!");
            } else {
                showFeedback(`ğŸ¥ Video ${currentUser.videoTerambil}/${currentUser.paketVideoLimit} direkam`);
            }
        }
        
        stopVideoTimer();
        
        // âœ… CLEANUP STREAMS
        if (audioStream) {
            audioStream.getTracks().forEach(track => track.stop());
        }
        recordingCanvas.remove();
    };

    // âœ… AUTO STOP SETELAH 15 DETIK UNTUK HINDARI FILE BESAR
    setTimeout(() => {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
            showFeedback("â± Rekaman dihentikan otomatis (max 15 detik)");
        }
    }, 15000); // âœ… 15 DETIK SAJA

    mediaRecorder.start();

    startRecBtn.style.display = 'none';
    pauseRecBtn.style.display = 'inline-block';
    stopRecBtn.style.display = 'inline-block';

    startVideoTimer();
}

function stopRecording() {  
  if (!mediaRecorder) return;  
  mediaRecorder.stop();
  
  // Setelah stop, tampilkan hanya tombol start lagi  
  startRecBtn.style.display = 'inline-block';  
  stopRecBtn.style.display = 'none';  
  pauseRecBtn.style.display = 'none';  
  if (typeof resumeRecBtn !== 'undefined')  
    resumeRecBtn.style.display = 'none';  
  videoControlsContainer.style.display = 'none';  
}

function pauseRecording() {  
  if (!mediaRecorder) return;  
  if (mediaRecorder.state === 'recording') {  
    mediaRecorder.pause();  
    pauseVideoTimer();  
    pauseRecBtn.style.display = 'none';  
    resumeRecBtn.style.display = 'inline-block';  
  }  
}

function resumeRecording() {  
  if (!mediaRecorder) return;  
  if (mediaRecorder.state === 'paused') {  
    mediaRecorder.resume();  
    resumeRecBtn.style.display = 'none';  
    pauseRecBtn.style.display = 'inline-block';  
    resumeVideoTimer();
  }  
}

// ğŸ¬ Tombol kontrol utama  
startBtn.onclick = startCamera;  
stopBtn.onclick = stopCamera;  

captureBtn.onclick = () => {
  if (!stream) {
    showCameraAlert(); // tampilkan pop-up jika kamera belum aktif
    return;
  }

  // Jika sedang menampilkan hasil foto di layar kamera
  if (showingPhoto) {
    // ğŸ‘‰ Tekan pertama: kembali ke mode kamera, tidak mengambil foto
    showingPhoto = false;
    isPreviewActive = false;
    startCamera(); // aktifkan kembali mode kamera
    return;
  }

  // ğŸ‘‰ Tekan kedua atau normal: ambil foto seperti biasa
  handleCapture();
};


deleteBtn.onclick = () => {  
  if (galleryImages.length === 0) { 
    alert("Belum ada foto/video yang bisa dihapus!"); 
    return; 
  }  

  const deletedItem = galleryImages.splice(currentIndex, 1)[0]; // hapus item

  // Hapus thumbnail dari galeri
  if (gallery.children[currentIndex]) gallery.removeChild(gallery.children[currentIndex]);  

  // Tentukan index berikutnya yang akan ditampilkan
  if (currentIndex >= galleryImages.length) currentIndex = galleryImages.length - 1;  

  if (currentIndex >= 0) {
    const nextItem = galleryImages[currentIndex];
    if (nextItem.type === 'photo') {
      showOnCamera(currentIndex);
    } else if (nextItem.type === 'video') {
      showVideoOnCamera(nextItem.data, true);
    }
  } else {
    // Tidak ada item tersisa, kembalikan ke mode kamera
    startCamera();
  }
};
  
filterSelect.addEventListener("change", () => {  
  video.style.filter = filterSelect.value;  
});  
  
function handleCapture() {  
  if (!stream) {  
    alert("âš  Nyalakan kamera terlebih dahulu!");  
    return;  
  }  
  
  const seconds = parseInt(timerSelect.value);  
  if (seconds === 0) { capturePhoto(); return; }  
  
  countdownEl.style.display = 'block';  
  let count = seconds;  
  countdownEl.textContent = count;  
  
  const interval = setInterval(() => {  
    playBeep();  
    count--;  
    countdownEl.textContent = count;  
    if (count <= 0) {  
      clearInterval(interval);  
      countdownEl.style.display = 'none';  
      capturePhoto();  
    }  
  }, 1000);  
}  

// âœ… TAMBAHKAN FUNGSI showCameraAlert() JIKA BELUM ADA
function showCameraAlert(message = "ğŸ¥ Nyalakan kamera terlebih dahulu!") {
    Swal.fire({
        title: 'âš  Kamera Tidak Aktif',
        text: message,
        icon: 'warning',
        confirmButtonText: 'OK',
        background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
        color: '#ffffff',
        confirmButtonColor: '#ff416c',
        width: '400px'
    });
}

// ==================== FUNGSI BARU: Video Quality Settings ====================
function getVideoConstraints() {
    // âœ… QUALITY SETTINGS YANG LEBIH RINGAN
    return {
        video: {
            width: { ideal: 640 },  // âœ… TURUNKAN RESOLUSI
            height: { ideal: 480 }, // âœ… DARI 1280x720 â†’ 640x480
            frameRate: { ideal: 15, max: 25 }, // âœ… TURUNKAN FPS
            facingMode: 'user',
            // âœ… KOMPRESI LEBIH BAIK
            aspectRatio: 1.333
        },
        audio: {
            sampleRate: 22050, // âœ… TURUNKAN SAMPLE RATE AUDIO
            channelCount: 1,
            echoCancellation: true,
            noiseSuppression: true
        }
    };
}

// ==================== FUNGSI BARU: Batasi Durasi Video ====================
function setupVideoDurationLimit() {
    // âœ… BATASI DURASI VIDEO MAX 15 DETIK (bukan 30)
    setTimeout(() => {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
            showFeedback("â± Rekaman dihentikan otomatis (max 15 detik)");
        }
    }, 15000); // âœ… 15 DETIK SAJA
}

// === DASHBOARD HANDLER ===                                          yhkkl';l'''''''''''''''''''''''''''''''''''
function showSection(section) {
    console.log("ğŸ”„ Menampilkan section:", section);
    
    // Sembunyikan semua section utama
    const sectionsToHide = ["dashboard", "photobooth-section", "pembayaran-section", "paket-section"];
    sectionsToHide.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = "none";
            console.log("âŒ Sembunyikan:", id);
        }
    });
    
    // Sembunyikan semua content section sidebar
    const sections = document.querySelectorAll(".contentSection");
    sections.forEach(sec => {
        sec.style.display = "none";
        console.log("âŒ Sembunyikan sidebar section:", sec.id);
    });
    
    // Tampilkan section yang dipilih
    if (section === "dashboard") {
        document.getElementById("dashboard").style.display = "block";
        console.log("âœ… Tampilkan: dashboard");
    } 

    else if (section === "photobooth") {
    // CEK: HARUS SUDAH LOGIN
    if (!currentUser) {
        showLoginMenu();
        document.getElementById("dashboard").style.display = "block";
        return;
    }

    // LOAD GALLERY USER
    loadUserGallery();

    // TAMPILKAN INFO COUNTER
    const trialInfo = document.getElementById('trialInfo');
    if (trialInfo) {
        if (currentUser.paket) {
            trialInfo.style.display = 'block';
            trialInfo.querySelector('h4').textContent = ` PAKET ${currentUser.paket.toUpperCase()}`;
            updatePackageCounter();
        } else {
            trialInfo.style.display = 'none';
        }
    }

    // âœ… PERBAIKAN: TAMPILKAN KAMERA CONTAINER TAPI JANGAN NYALAKAN KAMERA
    if (currentUser.paket === "Trial" && currentUser.waktuSisa > 0) {
        // âœ… INIT TIMER TAPI JANGAN JALANKAN
        paketActive = true;
        paketDuration = currentUser.paketDuration || 600; // 10 menit untuk trial
        waktuSisa = currentUser.waktuSisa;
        elapsedTime = currentUser.elapsedTime || 0;
        
        // âœ… TAMPILKAN TIMER TAPI PAUSED
        const displayTimer = document.getElementById("paketTimerDisplay");
        displayTimer.style.display = "block";
        displayTimer.innerText = "â¸ Timer paused: " + formatTime(waktuSisa);
        
        timerPaused = true;
        kameraAktif = false;
        
        document.getElementById("photobooth-section").style.display = "block";
        
        // âœ… TAMBAHKAN INI: TAMPILKAN KAMERA CONTAINER
        showCameraContainer();
        console.log("âœ… Masuk photobooth - Kamera container tampil, Timer siap (paused)");

    } else if (currentUser.pembayaranVerified && currentUser.waktuSisa > 0) {
        // âœ… SAMA UNTUK PAKET BAYAR
        paketActive = true;
        paketDuration = currentUser.paketDuration;
        waktuSisa = currentUser.waktuSisa;
        elapsedTime = currentUser.elapsedTime || 0;
        
        const displayTimer = document.getElementById("paketTimerDisplay");
        displayTimer.style.display = "block";
        displayTimer.innerText = "â¸ Timer paused: " + formatTime(waktuSisa);
        
        timerPaused = true;
        kameraAktif = false;
        
        document.getElementById("photobooth-section").style.display = "block";
        
        // âœ… TAMBAHKAN INI: TAMPILKAN KAMERA CONTAINER
        showCameraContainer();
        console.log("âœ… Masuk photobooth - Kamera container tampil, Timer siap (paused)");

    } else {
        // BELUM BAYAR ATAU WAKTU HABIS
        if (currentUser.paket === "Trial" && currentUser.waktuSisa <= 0) {
            alert("ğŸ˜Š Waktu trial Anda sudah habis! Silakan pilih paket berbayar.");
        } else if (currentUser.paket && currentUser.paket !== "Trial") {
            alert("â–³ Silakan lakukan pembayaran terlebih dahulu!");
        } else {
            alert("â–³ Silakan pilih paket terlebih dahulu di Menu Paket!");
        }
        document.getElementById("dashboard").style.display = "block";
        return;
    }
}
    else if (section === "pembayaran") {
        // âœ… CEK: HARUS SUDAH LOGIN
        if (!currentUser) {
            showLoginMenu();
            document.getElementById("dashboard").style.display = "block";
            return;
        }
        
        // âœ… CEK: SUDAH PILIH PAKET BAYAR (TRIAL TIDAK DIANGGAP)
        if (!currentUser.paket || currentUser.paket === "Trial") {
            alert("ğŸ“¦ Silakan pilih paket berbayar terlebih dahulu di Menu Paket!");
            document.getElementById("dashboard").style.display = "block";
            return;
        }
        
        // âœ… CEK: SUDAH BAYAR
        if (currentUser.pembayaranVerified) {
            alert("âœ… Anda sudah memiliki paket aktif! Tidak perlu bayar lagi.");
            document.getElementById("dashboard").style.display = "block";
            return;
        }
        
        document.getElementById("pembayaran-section").style.display = "block";
        console.log("âœ… Tampilkan: pembayaran-section");
        
        // âœ… OTOMATIS ISI JENIS PAKET & HARGA BERDASARKAN PILIHAN USER
        updateJenisPaketField();
    } 
    else if (section === "paket") {
        document.getElementById("paket-section").style.display = "block";
        console.log("âœ… Tampilkan: paket-section");
    }
    else {
        // Untuk section sidebar (filesContent, guideContent, aboutContent)
        const targetSection = document.getElementById(section);
        if (targetSection) {
            targetSection.style.display = "block";
            console.log("âœ… Tampilkan sidebar section:", section);
            console.log("ğŸ“ Posisi:", targetSection.getBoundingClientRect());
            console.log("ğŸ¨ Style display:", window.getComputedStyle(targetSection).display);
            
            // Force redraw dan beri border debug
            targetSection.style.border = "3px solid #00ff00";
            targetSection.style.background = "rgba(0,255,0,0.1)";
        } else {
            console.error("âŒ Section tidak ditemukan:", section);
        }
    }
    
    // âœ… UPDATE STATUS DASHBOARD
    updateDashboardStatus();
    
    // âœ… UPDATE SIDEBAR STATE SETELAH GANTI SECTION
    setTimeout(() => {
        updateSidebarState();
    }, 100);
}

// âœ… FUNGSI BARU: UPDATE FIELD JENIS PAKET & HARGA OTOMATIS
function updateJenisPaketField() {
    const jenisPaketField = document.getElementById('jenisPaket');
    const hargaPaketField = document.getElementById('hargaPaket');
    
    if (jenisPaketField && hargaPaketField && currentUser && currentUser.paket) {
        // Isi jenis paket
        jenisPaketField.value = currentUser.paket;
        
        // Isi harga paket berdasarkan jenis paket
        const harga = getTotalByPaket();
        hargaPaketField.value = harga;
        
        console.log("âœ… Jenis & harga paket diisi otomatis:", currentUser.paket, harga);
    } else {
        console.log("âŒ Tidak bisa mengisi jenis & harga paket:", {
            jenisField: !!jenisPaketField,
            hargaField: !!hargaPaketField,
            user: !!currentUser,
            paket: currentUser?.paket
        });
    }
}

// âœ… FUNGSI BARU: DAPATKAN HARGA BERDASARKAN JENIS PAKET
function getTotalByPaket() {
    if (!currentUser || !currentUser.paket) return 'Rp 0';
    
    const harga = {
        'Trial': 'GRATIS',
        'Basic': 'Rp 10.000',
        'Premium': 'Rp 15.000', 
        'VIP': 'Rp 20.000'
    };
    
    return harga[currentUser.paket] || 'Rp 0';
}

function kirimPembayaran() {
    const nama = document.getElementById('nama').value;
    const email = document.getElementById('email').value;
    const nohp = document.getElementById('nohp').value;
    const metode = document.getElementById('metode').value;

    // âœ… VALIDASI (tetap sama)
    if (!nama.trim() || !email.trim() || !nohp.trim() || !metode) {
        alert("âš  Mohon lengkapi semua data sebelum mengirim pembayaran!");
        return;
    }

    // âœ… PROSES PEMBAYARAN (tetap sama)
    paketActive = true;
    pembayaranVerified = true;
    waktuSisa = paketDuration;

    currentUser.paket = getPaketName(paketDuration);
    currentUser.paketDuration = paketDuration;
    currentUser.waktuSisa = waktuSisa;
    currentUser.pembayaranVerified = true;
    localStorage.setItem('user_' + currentUser.email, JSON.stringify(currentUser));
    localStorage.setItem('currentUser', JSON.stringify(currentUser));

    // âœ… TAMPILKAN POPUP BUKTI PEMBAYARAN (BARU!)
    tampilkanBuktiPembayaran(nama, email, nohp, metode);
    
    // âŒ SEMBUNYIKAN/HAPUS TAMPILAN TEXT LAMA (jika ada)
    const hasilDiv = document.getElementById('hasilPembayaran');
    if (hasilDiv) {
        hasilDiv.style.display = 'none';
    }
    
    // Reset form
    document.getElementById('formPembayaran').reset();
}

// âœ… FUNGSI BARU: TAMPILKAN POPUP BUKTI PEMBAYARAN
function tampilkanBuktiPembayaran(nama, email, nohp, metode) {
    const popup = document.getElementById('buktiPembayaranPopup');
    const now = new Date();
    
    // Format tanggal seperti BCA: DD/MM/YYYY HH:MM:SS
    const formattedDate = `${now.getDate().toString().padStart(2, '0')}/${(now.getMonth()+1).toString().padStart(2, '0')}/${now.getFullYear()} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
    
    // Generate nomor referensi acak
    const referensi = generateReferensi();
    
    // Tentukan total berdasarkan paket
    const total = getTotalByPaket();
    
    // Isi data ke popup
    document.getElementById('buktiTanggal').textContent = formattedDate;
    document.getElementById('buktiReferensi').textContent = referensi;
    document.getElementById('buktiMetode').textContent = getMetodeDisplay(metode);
    document.getElementById('buktiJenisPaket').textContent = currentUser.paket; // âœ… JENIS PAKET
    document.getElementById('buktiNama').textContent = nama;
    document.getElementById('buktiEmail').textContent = email;
    document.getElementById('buktiNoHP').textContent = nohp;
    document.getElementById('buktiTotal').textContent = total;
    
    // Simpan data untuk download
    currentBuktiData = { 
        nama, 
        email, 
        nohp, 
        metode, 
        jenisPaket: currentUser.paket, // âœ… SIMPAN JENIS PAKET
        tanggal: formattedDate, 
        referensi, 
        total 
    };
    
    // Tampilkan popup
    popup.style.display = 'flex';
}
// âœ… FUNGSI BARU: GENERATE NOMOR REFERENSI
function generateReferensi() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let result = '';
    for (let i = 0; i < 20; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
}

// âœ… FUNGSI BARU: TENTUKAN TOTAL BERDASARKAN PAKET
function getTotalByPaket() {
    if (!currentUser || !currentUser.paket) return 'Rp 0';
    
    const harga = {
        'Basic': 'Rp 10.000',
        'Premium': 'Rp 15.000', 
        'VIP': 'Rp 20.000'
    };
    
    return harga[currentUser.paket] || 'Rp 0';
}

// âœ… FUNGSI BARU: KONVERSI METODE KE DISPLAY
function getMetodeDisplay(metode) {
    const metodeMap = {
        'transfer': 'Transfer Bank',
        'qris': 'QRIS',
        'ewallet': 'GOPAY'
    };
    return metodeMap[metode] || metode;
}

// âœ… FUNGSI BARU: TUTUP POPUP
function tutupBuktiPembayaran() {
    const popup = document.getElementById('buktiPembayaranPopup');
    popup.style.display = 'none';
    
    // Redirect ke dashboard
    setTimeout(() => {
        showSection("dashboard");
        updateDashboardStatus();
    }, 300);
}

// âœ… FUNGSI BARU: DOWNLOAD STRUK (DENGAN JENIS PAKET)
function downloadBuktiPembayaran() {
    if (!currentBuktiData) return;
    
    // Buat canvas untuk generate gambar struk
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 400;
    canvas.height = 550; // âœ… TINGGI DITAMBAH UNTUK JENIS PAKET
    
    // Background putih
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Header biru
    ctx.fillStyle = '#004b8d';
    ctx.fillRect(0, 0, canvas.width, 80);
    
    // Text header
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('m-Transfer', canvas.width/2, 35);
    ctx.font = '14px Arial';
    ctx.fillText('Photo Booth App', canvas.width/2, 55);
    
    // Status berhasil
    ctx.fillStyle = '#00a650';
    ctx.font = 'bold 18px Arial';
    ctx.fillText('BERHASIL', canvas.width/2, 100);
    
    // Detail transaksi
    ctx.fillStyle = '#333333';
    ctx.font = '14px Arial';
    ctx.textAlign = 'left';
    let y = 140;
    
    const details = [
        `Tanggal: ${currentBuktiData.tanggal}`,
        `Referensi: ${currentBuktiData.referensi}`,
        `Metode: ${getMetodeDisplay(currentBuktiData.metode)}`,
        `Jenis Paket: ${currentBuktiData.jenisPaket}`, // âœ… JENIS PAKET
        `Nama: ${currentBuktiData.nama}`,
        `Email: ${currentBuktiData.email}`,
        `No. HP: ${currentBuktiData.nohp}`,
        `Total: ${currentBuktiData.total}`
    ];
    
    details.forEach(detail => {
        ctx.fillText(detail, 20, y);
        y += 25;
    });
    
    // Footer
    ctx.font = '12px Arial';
    ctx.fillStyle = '#666666';
    ctx.textAlign = 'center';
    ctx.fillText('Biaya Termasuk PPN (Bila ada)', canvas.width/2, y + 30);
    ctx.fillText('PT. PHOTO BOOTH KELOMPOK 3', canvas.width/2, y + 45);
    ctx.fillText('NPWP : 0013084496091000', canvas.width/2, y + 60);
    
    // Convert ke image dan download
    const link = document.createElement('a');
    link.download = `bukti-pembayaran-${currentBuktiData.referensi}.png`;
    link.href = canvas.toDataURL();
    link.click();
    
    // Feedback
    alert('âœ… Struk pembayaran berhasil didownload!');
}

function pilihPaket(namaPaket) {
    console.log("ğŸ“¦ Memilih paket:", namaPaket);
    
    // âœ… CEK APAKAH SUDAH LOGIN
    if (!currentUser) {
        showLoginMenu();
        return;
    }
    
    // âœ… CEK APAKAH SUDAH ADA PAKET AKTIF (KECUALI TRIAL)
    if (currentUser.pembayaranVerified && currentUser.waktuSisa > 0 && namaPaket !== 'Trial') {
        Swal.fire({
            title: 'âš  Paket Aktif Ditemukan',
            html: `Anda sedang memiliki <strong>${currentUser.paket}</strong> yang aktif.<br><br>
                   Dengan membeli paket baru, paket aktif Anda akan <strong>hilang</strong> dan diganti dengan paket baru.`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Ya, Lanjutkan',
            cancelButtonText: 'Batal',
            background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
            color: '#ffffff',
            confirmButtonColor: '#ff416c',
            cancelButtonColor: '#6c757d',
            width: '450px'
        }).then((result) => {
            if (result.isConfirmed) {
                prosesPembelianPaket(namaPaket);
            }
        });
        return;
    }
    
    // âœ… LANGSUNG PROSES UNTUK TRIAL ATAU TIDAK ADA PAKET AKTIF
    prosesPembelianPaket(namaPaket);
}

// âœ… FUNGSI BARU: PROSES PEMBELIAN PAKET (TERPISAH)
function prosesPembelianPaket(namaPaket) {
    console.log("ğŸ”„ Memproses pembelian paket:", namaPaket);
    
    // âœ… CEK APAKAH SUDAH PERNAH PAKAI TRIAL
    if (namaPaket === "Trial" && currentUser.trialUsed) {
        Swal.fire({
            title: 'âŒ Trial Sudah Dipakai',
            html: `
                <div style="text-align: left; margin: 15px 0;">
                    <p><strong>Anda sudah menggunakan paket Trial sebelumnya!</strong></p>
                    <p>Paket Trial hanya bisa digunakan <strong>sekali saja</strong> per akun.</p>
                    <br>
                    <p>ğŸ’¡ Silakan pilih paket berbayar untuk terus menggunakan Photo Booth.</p>
                </div>
            `,
            icon: 'warning',
            confirmButtonText: 'Pilih Paket Berbayar',
            background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
            color: '#ffffff',
            confirmButtonColor: '#ff416c',
            width: '500px'
        }).then((result) => {
            showSection("paket");
        });
        return;
    }
    
    // Set durasi dan limit berdasarkan paket
    if (namaPaket === "Trial") {
        paketDuration = 10 * 60;
        paketFotoLimit = 5;
        paketVideoLimit = 1;
    } else if (namaPaket === "Basic") {
        paketDuration = 60 * 60; 
        paketFotoLimit = 10;
        paketVideoLimit = 2;
    } else if (namaPaket === "Premium") {
        paketDuration = 2 * 60 * 60;
        paketFotoLimit = 20;
        paketVideoLimit = 5;
    } else if (namaPaket === "VIP") {
        paketDuration = 3 * 60 * 60;
        paketFotoLimit = 30;  // âœ… VIP JUGA ADA LIMIT
        paketVideoLimit = 10;
    } else {
        console.error("âŒ Nama paket tidak valid:", namaPaket);
        return;
    }
    
    // âœ… SIMPAN DATA PAKET KE USER
    currentUser.paket = namaPaket;
    currentUser.paketDuration = paketDuration;
    currentUser.paketFotoLimit = paketFotoLimit;
    currentUser.paketVideoLimit = paketVideoLimit;
    currentUser.fotoTerambil = 0;
    currentUser.videoTerambil = 0;
    currentUser.elapsedTime = 0;
    
    // âœ… TANDAI JIKA INI TRIAL SUDAH DIPAKAI
    if (namaPaket === "Trial") {
        currentUser.trialUsed = true;
    }
    
    // âœ… STATUS BERBEDA UNTUK TRIAL vs BAYAR
    if (namaPaket === "Trial") {
        paketActive = true;
        pembayaranVerified = false;
        currentUser.pembayaranVerified = false;
        currentUser.waktuSisa = paketDuration;
        
        Swal.fire({
            title: 'ğŸ¯ Paket Trial Dipilih!',
            html: `
                <div style="text-align: left; margin: 15px 0;">
                    <p><strong>Paket Trial sekarang AKTIF!</strong></p>
                    <p>âœ… Durasi: 10 menit</p>
                    <p>âœ… 3 Foto + 1 Video</p>
                    <p>âœ… Langsung bisa digunakan di Photo Booth</p>
                    <br>
                    <p>âš  <strong>Note:</strong> Trial hanya bisa digunakan <strong>sekali saja</strong></p>
                </div>
            `,
            icon: 'success',
            confirmButtonText: 'Kembali ke Menu Utama',
            background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
            color: '#ffffff',
            confirmButtonColor: '#4CAF50',
            width: '500px'
        }).then((result) => {
            showSection("dashboard");
        });
        
    } else {
        paketActive = false;
        pembayaranVerified = false;
        currentUser.pembayaranVerified = false;
        currentUser.waktuSisa = 0;
        
        alert(`Anda memilih Paket ${namaPaket}\nSilahkan lanjutkan ke Menu Pembayaran`);
        showSection("dashboard");
    }
    
    // Simpan ke localStorage
    localStorage.setItem('user_' + currentUser.email, JSON.stringify(currentUser));
    localStorage.setItem('currentUser', JSON.stringify(currentUser));

    loadUserGallery();
    
    updateDashboardStatus();
}

function mulaiTimerPaket() {
    const displayTimer = document.getElementById("paketTimerDisplay");
    
    // âœ… HENTIKAN TIMER SEBELUMNYA JIKA ADA
    clearInterval(paketTimer);
    
    // âœ… HITUNG WAKTU YANG SUDAH BERJALAN
    if (startTime === null) {
        startTime = Date.now() - elapsedTime;
    } else {
        startTime = Date.now() - elapsedTime;
    }
    
    displayTimer.style.display = "block";

    paketTimer = setInterval(() => {
        const now = Date.now();
        elapsedTime = now - startTime;
        waktuSisa = Math.max(0, paketDuration - Math.floor(elapsedTime / 1000));
        
        displayTimer.innerText = "Sisa waktu: " + formatTime(waktuSisa);

        // âœ… AUTO-SAVE SISA WAKTU SETIAP 10 DETIK
        if (currentUser && elapsedTime % 10000 < 1000) {
            currentUser.waktuSisa = waktuSisa;
            currentUser.elapsedTime = elapsedTime; // âœ… SIMPAN JUGA elapsedTime
            enhancedSaveUserData().then(success => {
                if (success) {
                    console.log("ğŸ’¾ Waktu paket disimpan:", formatTime(waktuSisa));
                }
            });
        }

        // âœ… CEK JIKA WAKTU HABIS
        if (waktuSisa <= 0) {
            clearInterval(paketTimer);
            paketActive = false;
            displayTimer.innerText = "â° Waktu paket habis";
            
            // âœ… UPDATE USER PROFILE
            if (currentUser) {
                currentUser.waktuSisa = 0;
                currentUser.pembayaranVerified = false;
                currentUser.elapsedTime = 0;
                enhancedSaveUserData();
            }
            
            // âœ… TAMPILKAN ALERT DAN MATIKAN KAMERA
            Swal.fire({
                title: 'â° Waktu Habis',
                text: 'Waktu paket Anda sudah habis. Silakan beli paket baru.',
                icon: 'warning',
                confirmButtonText: 'OK'
            });
            
            stopCamera();
            document.getElementById("captureBtn").disabled = true;
        }
    }, 1000);
    
    console.log("â–¶ Timer paket berjalan - Kamera aktif");
}

function pauseTimerPaket() {
    // âœ… HENTIKAN TIMER TAPI SIMPAN STATUS
    clearInterval(paketTimer);
    
    // âœ… SIMPAN elapsedTime UNTUK DILANJUTKAN NANTI
    if (startTime !== null) {
        elapsedTime = Date.now() - startTime;
    }
    
    console.log("â¸ Timer paket di-pause - Kamera non-aktif");
    
    // âœ… UPDATE DISPLAY TIMER
    const displayTimer = document.getElementById("paketTimerDisplay");
    if (displayTimer && waktuSisa > 0) {
        displayTimer.innerText = "â¸ Timer paused: " + formatTime(waktuSisa);
    }
}

function formatTime(sec) {
  let m = Math.floor(sec / 60);
  let s = sec % 60;
  return `${m}:${s.toString().padStart(2, '0')}`;
}

function handlePembayaranClick() {
    if (!currentUser) {
        // âœ… BELUM LOGIN: LANGSUNG TAMPILKAN POPUP LOGIN
        showLoginMenu();
        return;
    }
    
    // âœ… CEK APAKAH SUDAH PILIH PAKET BAYAR (TRIAL TIDAK DIANGGAP)
    if (!currentUser.paket || currentUser.paket === "Trial") {
        alert("ğŸ“¦ Silakan pilih paket berbayar terlebih dahulu di Menu Paket!");
        showSection('paket');
        return;
    }
    
    // âœ… CEK APAKAH SUDAH BAYAR
    if (currentUser.pembayaranVerified) {
        alert("âœ… Anda sudah memiliki paket aktif! Tidak perlu bayar lagi.");
        showSection('dashboard');
        return;
    }
    
    showSection('pembayaran');
}

function handlePhotoboothClick() {
    if (!currentUser) {
        // âœ… BELUM LOGIN: LANGSUNG TAMPILKAN POPUP LOGIN
        showLoginMenu();
        return;
    }
    
    // âœ… SUDAH LOGIN: CEK APAKAH PAKET TRIAL ATAU SUDAH BAYAR
    if (currentUser.paket === "Trial" && currentUser.waktuSisa > 0) {
        // âœ… TRIAL AKTIF: LANGSUNG BISA
        showSection('photobooth');
    } 
    else if (currentUser.pembayaranVerified && currentUser.waktuSisa > 0) {
        // âœ… SUDAH BAYAR: LANGSUNG BISA
        showSection('photobooth');
    }
    else {
        // âŒ BELUM ADA PAKET AKTIF
        if (!currentUser.paket) {
            alert("ğŸ“¦ Silakan pilih paket terlebih dahulu di Menu Paket!");
        } else if (currentUser.paket === "Trial" && currentUser.waktuSisa <= 0) {
            alert("â° Waktu trial Anda sudah habis! Silakan pilih paket berbayar.");
        } else {
            alert("âš  Silakan lakukan pembayaran terlebih dahulu!");
        }
    }
}

function updateDashboardStatus() {
    const statusDiv = document.getElementById('statusPembayaran');
    if (!statusDiv) return;

    if (pembayaranVerified) {
        // âœ… SUDAH BAYAR - BISA MASUK PHOTOBOOTH
        statusDiv.innerHTML = `
            <div style="background:rgba(0,255,0,0.1); border:2px solid #00ff00; padding:15px; border-radius:10px;">
                <h3>âœ… PAKET AKTIF</h3>
                <p>Pembayaran telah diverifikasi. Anda dapat menggunakan Photo Booth.</p>
                <p><strong>Sisa waktu: <span id="statusTimer">${formatTime(waktuSisa)}</span></strong></p>
            </div>
        `;
        statusDiv.style.display = 'block';
    } 
    else if (paketDuration) {
        // âœ… SUDAH PILIH PAKET TAPI BELUM BAYAR
        statusDiv.innerHTML = `
            <div style="background:rgba(255,255,0,0.1); border:2px solid #ffff00; padding:15px; border-radius:10px;">
                <h3>âš  MENUNGGU PEMBAYARAN</h3>
                <p>Anda sudah memilih paket. Silakan lakukan pembayaran untuk mengaktifkan Photo Booth.</p>
            </div>
        `;
        statusDiv.style.display = 'block';
    }
    else {
        // âŒ BELUM PILIH PAKET
        statusDiv.style.display = 'none';
    }
}

if (downloadBtn) {
    downloadBtn.addEventListener('click', downloadHasil);
}
if (printBtn) {
    printBtn.addEventListener('click', cetakFoto);
}

// âœ… FUNGSI DOWNLOAD HASIL (Foto & Video)
function downloadHasil() {
    if (galleryImages.length === 0) {
        alert("âš  Belum ada foto atau video yang bisa didownload!");
        return;
    }

    // Jika sedang menampilkan preview di kamera
    if (showingPhoto && galleryImages[currentIndex]) {
        const currentItem = galleryImages[currentIndex];
        downloadItem(currentItem);
    } else {
        // Jika tidak ada preview, download yang terakhir
        const lastItem = galleryImages[galleryImages.length - 1];
        downloadItem(lastItem);
    }
}

function downloadItem(item) {
    if (item.type === 'photo') {
        downloadFoto(item.data);
    } else if (item.type === 'video') {
        downloadVideo(item.data);
    }
}

function downloadFoto(dataURL) {
    const link = document.createElement('a');
    link.download = ` photo-booth-${new Date().getTime()}.png`;
    link.href = dataURL;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Efek feedback
    showFeedback("âœ… Foto berhasil didownload!");
}

// ==================== MODIFIKASI FUNGSI downloadVideo() ====================
// GANTI fungsi downloadVideo dengan ini:

function downloadVideo(videoURL) {
    // âœ… HANDLE BLOB URL UNTUK DOWNLOAD
    const link = document.createElement('a');
    link.download = `photo-booth-video-${new Date().getTime()}.webm`;
    link.href = videoURL;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    // Efek feedback
    showFeedback("âœ… Video berhasil didownload!");
}
// âœ… FUNGSI CETAK FOTO (Hanya Foto, bukan Video)
function cetakFoto() {
    if (galleryImages.length === 0) {
        alert("âš  Belum ada foto yang bisa dicetak!");
        return;
    }

    // Cari foto terakhir atau yang sedang dipreview
    let fotoToPrint = null;
    
    if (showingPhoto && galleryImages[currentIndex] && galleryImages[currentIndex].type === 'photo') {
        fotoToPrint = galleryImages[currentIndex].data;
    } else {
        // Cari foto terakhir dari gallery
        for (let i = galleryImages.length - 1; i >= 0; i--) {
            if (galleryImages[i].type === 'photo') {
                fotoToPrint = galleryImages[i].data;
                break;
            }
        }
    }

    if (!fotoToPrint) {
        alert("âš  Tidak ada foto yang bisa dicetak. Silakan ambil foto terlebih dahulu.");
        return;
    }

    printFoto(fotoToPrint);
}

function printFoto(dataURL) {
    // Simpan data foto ke localStorage
    localStorage.setItem('photoPrint', dataURL);
    
    // Buka window baru dengan print.html
    const printWindow = window.open('print.html', '_blank', 'width=800,height=600');
    
    if (!printWindow) {
        alert("âš  Pop-up diblokir! Silakan izinkan pop-up untuk mencetak.");
        
        // Fallback: download manual
        const link = document.createElement('a');
        link.download = `photo-booth-${Date.now()}.png`;
        link.href = dataURL;
        link.click();
        
        showFeedback("ğŸ“¥ Foto didownload - silakan print manual");
        return;
    }
    
    showFeedback("ğŸ–¨ï¸ Membuka halaman print...");
}

// âœ… FUNGSI FEEDBACK UNTUK USER
function showFeedback(message) {
    // Hapus feedback sebelumnya jika ada
    const existingFeedback = document.getElementById('feedbackMessage');
    if (existingFeedback) {
        existingFeedback.remove();
    }

    // Buat elemen feedback baru
    const feedback = document.createElement('div');
    feedback.id = 'feedbackMessage';
    feedback.textContent = message;
    feedback.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0, 255, 0, 0.9);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        animation: fadeInOut 3s ease-in-out;
    `;

    document.body.appendChild(feedback);

    // Hapus otomatis setelah 3 detik
    setTimeout(() => {
        if (feedback.parentNode) {
            feedback.parentNode.removeChild(feedback);
        }
    }, 3000);
}

// âœ… TAMBAH CSS ANIMASI UNTUK FEEDBACK
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeInOut {
        0% { opacity: 0; transform: translateY(-20px); }
        10% { opacity: 1; transform: translateY(0); }
        90% { opacity: 1; transform: translateY(0); }
        100% { opacity: 0; transform: translateY(-20px); }
    }
`;
document.head.appendChild(style);

    if (menuHome) {
        menuHome.addEventListener('click', function(event) {
            handleHomeClick(event);
            if (getCurrentSection() !== 'dashboard') {
                closeSidebar();
            }
        });
    }
function handleHomeClick(event) {
    // Single click - langsung kembali ke dashboard
    showSection('dashboard');
    
    // Double click detection
    if (homeClickTimer) {
        // Double click detected
        clearTimeout(homeClickTimer);
        homeClickTimer = null;
        handleDoubleClick();
    } else {
        // Single click - tunggu sebentar untuk cek double click
        homeClickTimer = setTimeout(() => {
            homeClickTimer = null;
            // Single click action sudah dilakukan di atas (showSection)
        }, 300);
    }
}
function handleDoubleClick() {
    console.log("ğŸ”„ Double click detected - refreshing...");
    
    // Feedback visual
    menuHome.classList.add('home-double-click');
    setTimeout(() => {
        menuHome.classList.remove('home-double-click');
    }, 600);
    
    // Tampilkan konfirmasi
        resetAppState();
        
        // Feedback sebelum refresh
        showFeedback("ğŸ”„ Merefresh halaman...");
        
        // Refresh halaman setelah delay kecil
        setTimeout(() => {
            location.reload();
        }, 1000);
    }

function resetAppState() {
    // Reset semua variable state
    paketActive = false;
    pembayaranVerified = false;
    paketDuration = 0;
    waktuSisa = 0;
    
    // âœ… RESET VARIABLE TIMER BARU
    kameraAktif = false;
    timerPaused = true;
    startTime = null;
    elapsedTime = 0;

    // Hentikan semua timer
    if (paketTimer) clearInterval(paketTimer);
    if (videoTimerInterval) clearInterval(videoTimerInterval);

    // Matikan kamera jika aktif
    if (stream) {
        stopCamera();
    }

    // Reset gallery
    galleryImages = [];
    gallery.innerHTML = "";
    currentIndex = 0;

    console.log("ğŸ”„ State aplikasi direset termasuk timer");
}

function hubungiKami() {
    console.log("ğŸ” Fungsi hubungiKami dipanggil!"); // âœ… DEBUG
    
    const nomorWhatsApp = '6282163235170'; // âœ… GANTI DENGAN NOMOR ANDA
    const pesanOtomatis = 'Halo web photo booth online ya? Saya ingin bertanya tentang layanan photo booth Anda.';
    const pesanEncoded = encodeURIComponent(pesanOtomatis);
    const urlWhatsApp = `https://wa.me/${nomorWhatsApp}?text=${pesanEncoded}`;
    
    console.log("ğŸ“± URL WhatsApp:", urlWhatsApp); // âœ… DEBUG
    
    // Tampilkan konfirmasi sebelum redirect
    Swal.fire({
        title: 'ğŸ“ Hubungi Kami',
        html: `
            <div style="text-align: left; margin: 15px 0;">
                <p><strong>Anda akan diarahkan ke WhatsApp</strong></p>
                <p>ğŸ“± Nomor: +${nomorWhatsApp}</p>
            </div>
        `,
        icon: 'info',
        showCancelButton: true,
        confirmButtonText: 'Buka WhatsApp',
        cancelButtonText: 'Batal',
        background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
        color: '#ffffff',
        confirmButtonColor: '#25D366',
        cancelButtonColor: '#6c757d',
        width: '400px',
        padding: '1.2rem',
        customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            htmlContainer: 'custom-swal-text'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            console.log("âœ… User mengkonfirmasi, membuka WhatsApp...");
            window.open(urlWhatsApp, '_blank');
            showFeedback("ğŸ“± Membuka WhatsApp...");
        } else {
            console.log("âŒ User membatalkan");
        }
    });
}

// ===== EVENT LISTENERS TERPUSAT =====
document.addEventListener('DOMContentLoaded', function() {
    console.log("ğŸš€ Aplikasi Photo Booth dimuat");
    
    // Inisialisasi sidebar
    initSidebar();
    
    // âœ… EVENT LISTENER UNTUK MENU LOGIN
    if (menuLogin) {
        menuLogin.addEventListener('click', function() {
            if (currentUser) {
                showUserMenu();
            } else {
                showLoginMenu();
            }
        });
        console.log("âœ… Event listener Login berhasil dipasang");
    }

    // Camera controls
    startBtn.onclick = startCamera;
    stopBtn.onclick = stopCamera;
    captureBtn.onclick = () => {
        if (!stream) {
            showCameraAlert();
            return;
        }
        if (showingPhoto) {
            showingPhoto = false;
            isPreviewActive = false;
            startCamera();
            return;
        }
        handleCapture();
    };
    
    videoBtn.onclick = async () => {  
        if (!stream) {  
            showCameraAlert("ğŸ¥ Nyalakan kamera terlebih dahulu!");  
            return;  
        }  
        await startCamera();  
        canvas.style.display = 'none';
        video.controls = false;
        showingPhoto = false;
        if(currentFrame !== "") {
            frameOverlay.style.display = 'block';
        } else {
            frameOverlay.style.display = 'none';
        }
        videoControlsContainer.style.display = 'flex';  
        startRecBtn.style.display = 'inline-block';  
        stopRecBtn.style.display = 'none';  
        pauseRecBtn.style.display = 'none';  
        stopVideoTimer();  
    };
    
    deleteBtn.onclick = () => {
    if (galleryImages.length === 0) {
        alert("Belum ada foto/video yang bisa dihapus!");
        return;
    }

    const deletedItem = galleryImages.splice(currentIndex, 1)[0];

    // âœ… HAPUS JUGA DARI USER GALLERY (PERMANEN) DENGAN SYSTEM BARU
    if (currentUser && currentUser.gallery) {
        const itemIndex = currentUser.gallery.findIndex(item => item.id === deletedItem.id);
        if (itemIndex !== -1) {
            currentUser.gallery.splice(itemIndex, 1);
            
            // âœ… SIMPAN PERUBAHAN KE STORAGE
            enhancedSaveUserData().then(success => {
                if (success) {
                    console.log("âœ… Item dihapus permanen dari storage");
                }
            });
        }
    }

    if (gallery.children[currentIndex]) gallery.removeChild(gallery.children[currentIndex]);

    if (currentIndex >= galleryImages.length) currentIndex = galleryImages.length - 1;

    if (currentIndex >= 0) {
        const nextItem = galleryImages[currentIndex];
        if (nextItem.type === 'photo') {
            showOnCamera(currentIndex);
        } else if (nextItem.type === 'video') {
            showVideoOnCamera(nextItem.data, true);
        }
    } else {
        startCamera();
    }

    setTimeout(() => {
        limitVisibleThumbnails();
        updateScrollButtons();
    }, 100);
};
    
    // âœ… VIDEO RECORDING CONTROLS DENGAN FUNGSI BARU
    startRecBtn.onclick = startRecording;
    pauseRecBtn.onclick = pauseRecording;
    resumeRecBtn.onclick = resumeRecording;
    stopRecBtn.onclick = stopRecording;
    
    // Filter & Frame
    filterSelect.addEventListener("change", () => {
        video.style.filter = filterSelect.value;
    });
    
    frameSelect.addEventListener('change', () => {
        const selectedFrame = frameSelect.value;
        if (!selectedFrame) {
            frameOverlay.style.display = 'none';
            currentFrame = "";
        } else {
            currentFrame = selectedFrame;
            frameOverlay.src = selectedFrame;
            frameOverlay.style.display = 'block';
        }
    });
    
    // Menu Sidebar
    if (menuHome) {
        menuHome.addEventListener('click', function(event) {
            handleHomeClick(event);
            if (getCurrentSection() !== 'dashboard') {
                closeSidebar();
            }
        });
    }
    
    if (menuGuide) {
    menuGuide.addEventListener('click', function() {
        showPetunjukPenggunaan();
        closeSidebar();
        });
    }
    
    const menuHubungi = document.getElementById('menuHubungi');
    if (menuHubungi) {
        menuHubungi.addEventListener('click', function() {
            hubungiKami();
            closeSidebar();
        });
        console.log("âœ… Event listener Hubungi Kami berhasil dipasang");
    }
    
    // Download & Print
    if (downloadBtn) {
        downloadBtn.addEventListener('click', downloadHasil);
    }
    if (printBtn) {
        printBtn.addEventListener('click', cetakFoto);
    }
    // Update posisi download button ketika gallery berubah
    if (downloadBtn && printBtn) {
    // Panggil sekali saat load
    setTimeout(updateDownloadButtonPosition, 100);
    
    // Update posisi ketika gallery berubah
    const galleryObserver = new MutationObserver(updateDownloadButtonPosition);
    const gallery = document.getElementById('gallery');
    if (gallery) {
        galleryObserver.observe(gallery, { childList: true, subtree: true });
    }
}

    // ğŸ  PERBAIKAN EVENT LISTENER UNTUK SCROLL GALLERY - VERSI DIPERBAIKI
    console.log("ğŸ  Memasang event listener untuk scroll gallery...");
    
    const scrollLeftBtn = document.getElementById('scrollLeftBtn');
    const scrollRightBtn = document.getElementById('scrollRightBtn');
    const gallery = document.getElementById('gallery');

    if (scrollLeftBtn) {
        scrollLeftBtn.addEventListener('click', scrollGalleryLeft);
        console.log("ğŸ  Event listener scroll kiri terpasang");
    } else {
        console.error("ğŸ  Tombol scroll kiri tidak ditemukan!");
    }

    if (scrollRightBtn) {
        scrollRightBtn.addEventListener('click', scrollGalleryRight);
        console.log("ğŸ  Event listener scroll kanan terpasang");
    } else {
        console.error("ğŸ  Tombol scroll kanan tidak ditemukan!");
    }

    if (gallery) {
        gallery.addEventListener('scroll', updateScrollButtons);
        console.log("ğŸ  Event listener scroll gallery terpasang");
        
        // ğŸ  OBSERVER UNTUK DETEKSI PERUBAHAN GALLERY
        const galleryObserver = new MutationObserver(() => {
            setTimeout(updateScrollButtons, 100);
        });
        
        galleryObserver.observe(gallery, { 
            childList: true, 
            subtree: true 
        });
        console.log("ğŸ  Observer gallery terpasang");
    }
    
    // ğŸ  INIT TOMBOL SCROLL PERTAMA KALI
    setTimeout(() => {
        updateScrollButtons();
        console.log("ğŸ  Inisialisasi tombol scroll selesai");
    }, 1000);
    
    console.log("âœ… Gallery scroll system initialized");
    
    // âœ… PASTIKAN STATE AWAL SIDEBAR BENAR
    setTimeout(() => {
        updateSidebarState();
    }, 500);

    // âœ… AUTO LOGIN JIKA ADA SESSION
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        updateUIAfterLogin();
        updateDashboardStatus();
    }

    console.log("ğŸ¯ Semua event listener berhasil diinisialisasi");
});

// ===== âœ… SISTEM LOGIN DENGAN POPUP YANG SUDAH ADA =====

function showLoginMenu() {
    // âœ… PAKAI POPUP YANG SUDAH ADA - sama seperti alert/confirm
    Swal.fire({
        title: 'ğŸ” Akses Photo Booth',
        text: 'Apakah Anda sudah punya akun?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'âœ… Sudah Punya Akun',
        cancelButtonText: 'ğŸ“ Belum Punya Akun',
        background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
        color: '#ffffff',
        confirmButtonColor: '#ff416c',
        cancelButtonColor: '#6c757d',
        width: '400px',
        padding: '1.2rem',
        customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            htmlContainer: 'custom-swal-text'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            showLoginForm();
        } else if (result.dismiss === Swal.DismissReason.cancel) {
            showRegisterForm();
        }
    });
}

function showLoginForm() {
    // âœ… PAKAI POPUP YANG SUDAH ADA untuk input login
    Swal.fire({
        title: 'ğŸ”“ Login',
        html: `
            <div style="margin: 10px 0;">
                <input type="email" id="loginEmail" placeholder="Email" style="
                    width:100%; 
                    padding:12px; 
                    margin:8px 0; 
                    border-radius:8px; 
                    border:1px solid rgba(255,255,255,0.4); 
                    background:rgba(255,255,255,0.2); 
                    color:white;
                    font-size: 1rem;
                    box-sizing: border-box;
                ">
            </div>
            <div style="margin: 10px 0;">
                <input type="password" id="loginPassword" placeholder="Password" style="
                    width:100%; 
                    padding:12px; 
                    margin:8px 0; 
                    border-radius:8px; 
                    border:1px solid rgba(255,255,255,0.4); 
                    background:rgba(255,255,255,0.2); 
                    color:white;
                    font-size: 1rem;
                    box-sizing: border-box;
                ">
            </div>
        `,
        background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
        color: '#ffffff',
        confirmButtonText: 'Login',
        confirmButtonColor: '#ff416c',
        cancelButtonText: 'Kembali',
        showCancelButton: true,
        width: '400px',
        padding: '1.2rem',
        // âœ… TAMBAHKAN INI UNTUK HILANGKAN SCROLL
        heightAuto: false, // âœ… PENTING: Nonaktifkan auto height
        scrollbarPadding: false, // âœ… HILANGKAN PADDING SCROLLBAR
        customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            htmlContainer: 'custom-swal-text'
        },
        preConfirm: () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                Swal.showValidationMessage('Harap isi email dan password');
                return false;
            }
            
            return { email, password };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            processLogin(result.value.email, result.value.password);
        } else if (result.dismiss === Swal.DismissReason.cancel) {
            showLoginMenu();
        }
    });
}

function showRegisterForm() {
    // âœ… PAKAI POPUP YANG SUDAH ADA untuk input register
    Swal.fire({
        title: 'ğŸ“ Daftar Akun Baru',
        html: `
            <div style="margin: 8px 0;">
                <input type="email" id="registerEmail" placeholder="Email" style="
                    width:100%; 
                    padding:12px; 
                    margin:6px 0; 
                    border-radius:8px; 
                    border:1px solid rgba(255,255,255,0.4); 
                    background:rgba(255,255,255,0.2); 
                    color:white;
                    font-size: 1rem;
                    box-sizing: border-box;
                ">
            </div>
            <div style="margin: 8px 0;">
                <input type="password" id="registerPassword" placeholder="Buat Password" style="
                    width:100%; 
                    padding:12px; 
                    margin:6px 0; 
                    border-radius:8px; 
                    border:1px solid rgba(255,255,255,0.4); 
                    background:rgba(255,255,255,0.2); 
                    color:white;
                    font-size: 1rem;
                    box-sizing: border-box;
                ">
            </div>
            <div style="margin: 8px 0;">
                <input type="password" id="confirmPassword" placeholder="Konfirmasi Password" style="
                    width:100%; 
                    padding:12px; 
                    margin:6px 0; 
                    border-radius:8px; 
                    border:1px solid rgba(255,255,255,0.4); 
                    background:rgba(255,255,255,0.2); 
                    color:white;
                    font-size: 1rem;
                    box-sizing: border-box;
                ">
            </div>
        `,
        background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
        color: '#ffffff',
        confirmButtonText: 'Daftar',
        confirmButtonColor: '#ff416c',
        cancelButtonText: 'Kembali',
        showCancelButton: true,
        width: '400px',
        padding: '1.2rem',
        // âœ… TAMBAHKAN INI UNTUK HILANGKAN SCROLL
        heightAuto: false, // âœ… PENTING: Nonaktifkan auto height
        scrollbarPadding: false, // âœ… HILANGKAN PADDING SCROLLBAR
        customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            htmlContainer: 'custom-swal-text'
        },
        preConfirm: () => {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (!email || !password || !confirm) {
                Swal.showValidationMessage('Harap isi semua field');
                return false;
            }
            
            if (password !== confirm) {
                Swal.showValidationMessage('Password tidak cocok');
                return false;
            }
            
            return { email, password };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            processRegister(result.value.email, result.value.password);
        } else if (result.dismiss === Swal.DismissReason.cancel) {
            showLoginMenu();
        }
    });
}

function processLogin(email, password) {
    const userData = JSON.parse(localStorage.getItem('user_' + email));
    
    if (userData && userData.password === password) {
        currentUser = userData;
        localStorage.setItem('currentUser', JSON.stringify(userData));
        
        // âœ… UPDATE DATA USER DENGAN STATUS TERBARU
        if (paketDuration > 0) {
            currentUser.paket = getPaketName(paketDuration);
            currentUser.waktuSisa = waktuSisa;
            localStorage.setItem('user_' + email, JSON.stringify(currentUser));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
        }
        
        Swal.fire({
            title: 'âœ… Login Berhasil',
            text: 'Selamat datang!',
            icon: 'success',
            confirmButtonText: 'OK',
            background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
            color: '#ffffff',
            confirmButtonColor: '#ff416c',
            width: '400px',
            padding: '1.2rem',
            customClass: {
                popup: 'custom-swal-popup',
                title: 'custom-swal-title',
                htmlContainer: 'custom-swal-text'
            }
        });
        
        updateUIAfterLogin();
    } else {
        Swal.fire({
            title: 'âŒ Login Gagal',
            text: 'Email atau password salah!',
            icon: 'error',
            confirmButtonText: 'Coba Lagi',
            background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
            color: '#ffffff',
            confirmButtonColor: '#ff416c',
            width: '400px',
            padding: '1.2rem',
            customClass: {
                popup: 'custom-swal-popup',
                title: 'custom-swal-title',
                htmlContainer: 'custom-swal-text'
            }
        }).then(() => {
            showLoginForm();
        });
    }
}

// âœ… FUNGSI BANTU: DAPATKAN NAMA PAKET DARI DURASI
function getPaketName(duration) {
    if (duration === 3600) return 'Basic';
    if (duration === 7200) return 'Premium'; 
    if (duration === 10800) return 'VIP';
    return null;
}

function processRegister(email, password) {
    if (localStorage.getItem('user_' + email)) {
        // âœ… PAKAI POPUP YANG SUDAH ADA untuk error
        Swal.fire({
            title: 'âŒ Pendaftaran Gagal',
            text: 'Email sudah terdaftar!',
            icon: 'error',
            confirmButtonText: 'Coba Lagi',
            background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
            color: '#ffffff',
            confirmButtonColor: '#ff416c',
            width: '400px',
            padding: '1.2rem',
            customClass: {
                popup: 'custom-swal-popup',
                title: 'custom-swal-title',
                htmlContainer: 'custom-swal-text'
            }
        }).then(() => {
            showRegisterForm();
        });
        return;
    }
    
    const userData = {
        email: email,
        password: password,
        paket: null,
        waktuSisa: 0,
        createdAt: new Date().toISOString()
    };
    
    localStorage.setItem('user_' + email, JSON.stringify(userData));
    
    // âœ… PAKAI POPUP YANG SUDAH ADA untuk sukses
    Swal.fire({
        title: 'âœ… Pendaftaran Berhasil',
        text: 'Silakan login dengan akun baru Anda!',
        icon: 'success',
        confirmButtonText: 'Login Sekarang',
        background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
        color: '#ffffff',
        confirmButtonColor: '#ff416c',
        width: '400px',
        padding: '1.2rem',
        customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            htmlContainer: 'custom-swal-text'
        }
    }).then(() => {
        showLoginForm();
    });
}

// âœ… EVENT LISTENER UNTUK MENU LOGIN
document.addEventListener('DOMContentLoaded', function() {
    const menuLogin = document.getElementById('menuLogin');
    if (menuLogin) {
        menuLogin.addEventListener('click', showLoginMenu);
    }
});

function updateUIAfterLogin() {
    if (currentUser) {
        // âœ… UBAH TAMPILAN MENU LOGIN JADI NAMA USER + ICON
        document.getElementById('menuLogin').innerHTML = `ğŸ‘¤ ${currentUser.email}`;
        updateDashboardStatus();
        
        // âœ… UBAH EVENT LISTENER UNTUK MENU USER
        const menuLogin = document.getElementById('menuLogin');
        menuLogin.removeEventListener('click', showLoginMenu); // Hapus listener lama
        menuLogin.addEventListener('click', showUserMenu); // Tambah listener baru
    }
}

// âœ… FUNGSI BARU: MENU USER SETELAH LOGIN
function showUserMenu() {
    let statusText = 'Belum ada paket aktif';
    if (currentUser.paket && currentUser.waktuSisa > 0) {
        statusText = `Paket ${currentUser.paket} - Sisa waktu: ${formatTime(currentUser.waktuSisa)}`;
    } else if (currentUser.paket) {
        statusText = `Paket ${currentUser.paket} - Menunggu pembayaran`;
    }
    
    Swal.fire({
        title: `ğŸ‘¤ ${currentUser.email}`,
        text: statusText,
        icon: 'info',
        showCancelButton: true,
        confirmButtonText: 'ğŸšª Logout',
        cancelButtonText: 'âœ– Batal',
        background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
        color: '#ffffff',
        confirmButtonColor: '#ff416c',
        cancelButtonColor: '#6c757d',
        width: '400px',
        padding: '1.2rem',
        customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            htmlContainer: 'custom-swal-text'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            processLogout();
        }
    });
}

// âœ… FUNGSI BARU: PROSES LOGOUT
function processLogout() {
    // Hapus data user dari localStorage
    localStorage.removeItem('currentUser');
    currentUser = null;
    
    // âœ… KEMBALIKAN TAMPILAN MENU LOGIN
    document.getElementById('menuLogin').innerHTML = 'ğŸ” Login/Register';
    
    // âœ… KEMBALIKAN EVENT LISTENER UNTUK LOGIN
    const menuLogin = document.getElementById('menuLogin');
    menuLogin.removeEventListener('click', showUserMenu); // Hapus listener user
    menuLogin.addEventListener('click', showLoginMenu); // Tambah listener login
    
    // âœ… TAMPILKAN POPUP LOGOUT BERHASIL
    Swal.fire({
        title: 'âœ… Logout Berhasil',
        text: 'Anda telah keluar dari akun.',
        icon: 'success',
        confirmButtonText: 'OK',
        background: 'linear-gradient(145deg, #2d6a4f, #40916c)',
        color: '#ffffff',
        confirmButtonColor: '#ff416c',
        width: '400px',
        padding: '1.2rem',
        customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            htmlContainer: 'custom-swal-text'
        }
    }).then(() => {
        // âœ… OTOMATIS KE HALAMAN UTAMA
        showSection('dashboard');
        
        // âœ… RESET STATUS PEMBAYARAN & PAKET
        paketActive = false;
        pembayaranVerified = false;
        paketDuration = 0;
        waktuSisa = 0;
        
        // âœ… UPDATE DASHBOARD
        updateDashboardStatus();
        
        // âœ… MATIKAN KAMERA JIKA SEDANG AKTIF
        if (stream) {
            stopCamera();
        }
        
        currentIndex = 0;
    });
}

// âœ… MODIFIKASI AUTO LOGIN SAAT PAGE LOAD
window.addEventListener('load', function() {
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        
        // âœ… LOAD DATA PAKET DARI USER PROFILE JIKA ADA
        if (currentUser.paket && currentUser.waktuSisa > 0) {
            paketActive = true;
            pembayaranVerified = true;
            paketDuration = currentUser.paketDuration || 0;
            waktuSisa = currentUser.waktuSisa || 0;
            
            console.log('âœ… Load paket dari user:', currentUser.paket, 'Sisa waktu:', waktuSisa);
        }
        
        // âœ… PASTIKAN EVENT LISTENER SESUAI STATUS LOGIN
        const menuLogin = document.getElementById('menuLogin');
        if (currentUser) {
            menuLogin.removeEventListener('click', showLoginMenu);
            menuLogin.addEventListener('click', showUserMenu);
        } else {
            menuLogin.removeEventListener('click', showUserMenu);
            menuLogin.addEventListener('click', showLoginMenu);
        }
        
        updateUIAfterLogin();
        updateDashboardStatus(); // âœ… UPDATE DASHBOARD DENGAN DATA PAKET
    }
});

// ===== âœ… FUNGSI BARU: UPDATE STATUS DI DASHBOARD =====
function updateDashboardStatus() {
    const statusDiv = document.getElementById('statusPembayaran');
    if (!statusDiv) return;

    // âœ… CEK DATA PAKET DARI USER PROFILE
    if (currentUser && currentUser.paket === "Trial" && currentUser.waktuSisa > 0) {
        // âœ… PAKET TRIAL AKTIF (TANPA STATUS PEMBAYARAN)
        statusDiv.innerHTML = `
            <div style="background:rgba(76, 175, 80, 0.2); border:2px solid #4CAF50; padding:15px; border-radius:10px;">
                <h3>ğŸ¯ PAKET TRIAL AKTIF</h3>
                <p>Anda sedang menggunakan paket Trial. Silakan masuk ke Photo Booth.</p>
                <p><strong>Sisa waktu: <span id="statusTimer">${formatTime(currentUser.waktuSisa)}</span></strong></p>
                <p><strong>Foto: ${currentUser.fotoTerambil || 0}/${currentUser.paketFotoLimit} | Video: ${currentUser.videoTerambil || 0}/${currentUser.paketVideoLimit}</strong></p>
            </div>
        `;
        statusDiv.style.display = 'block';
        
    } else if (currentUser && currentUser.pembayaranVerified && currentUser.waktuSisa > 0) {
        // âœ… SUDAH BAYAR & PAKET AKTIF (BAYAR)
        statusDiv.innerHTML = `
            <div style="background:rgba(0,255,0,0.1); border:2px solid #00ff00; padding:15px; border-radius:10px;">
                <h3>âœ… PAKET AKTIF - ${currentUser.paket}</h3>
                <p>Pembayaran telah diverifikasi. Anda dapat menggunakan Photo Booth.</p>
                <p><strong>Sisa waktu: <span id="statusTimer">${formatTime(currentUser.waktuSisa)}</span></strong></p>
            </div>
        `;
        statusDiv.style.display = 'block';
        
    } else if (currentUser && currentUser.paket && !currentUser.pembayaranVerified && currentUser.paket !== "Trial") {
        // âœ… SUDAH PILIH PAKET BAYAR TAPI BELUM BAYAR
        statusDiv.innerHTML = `
            <div style="background:rgba(255,255,0,0.1); border:2px solid #ffff00; padding:15px; border-radius:10px;">
                <h3>âš  MENUNGGU PEMBAYARAN - ${currentUser.paket}</h3>
                <p>Anda sudah memilih paket ${currentUser.paket}. Silakan lakukan pembayaran untuk mengaktifkan Photo Booth.</p>
            </div>
        `;
        statusDiv.style.display = 'block';
        
    } else {
        // âŒ BELUM PILIH PAKET ATAU SUDAH SELESAI
        statusDiv.style.display = 'none';
    }
}

function updateTrialCounter() {
    if (currentUser && currentUser.paket === "Trial") {
        const fotoCounter = document.getElementById('fotoCounter');
        const videoCounter = document.getElementById('videoCounter');
        
        if (fotoCounter) {
            fotoCounter.textContent = `${currentUser.fotoTerambil || 0}/${currentUser.paketFotoLimit}`;
        }
        if (videoCounter) {
            videoCounter.textContent = `${currentUser.videoTerambil || 0}/${currentUser.paketVideoLimit}`;
        }
    }
}

// âœ… FUNGSI BARU: UPDATE COUNTER UNTUK SEMUA PAKET
function updatePackageCounter() {
    if (currentUser && currentUser.paket) {
        const fotoCounter = document.getElementById('fotoCounter');
        const videoCounter = document.getElementById('videoCounter');
        
        if (fotoCounter) {
            fotoCounter.textContent = `${currentUser.fotoTerambil || 0}/${currentUser.paketFotoLimit}`;
        }
        if (videoCounter) {
            videoCounter.textContent = `${currentUser.videoTerambil || 0}/${currentUser.paketVideoLimit}`;
        }
        
        // âœ… UPDATE JUGA DI DASHBOARD JIKA ADA
        updateDashboardStatus();
    }
}

function loadUserGallery() {
    if (currentUser && currentUser.gallery && currentUser.gallery.length > 0) {
        galleryImages = [];
        gallery.innerHTML = "";
        console.log("ğŸ”„ Loading gallery dari storage:", currentUser.gallery.length + " items");

        currentUser.gallery.forEach((item, index) => {
            // VALIDASI DATA SEBELUM LOAD
            if (!item || !item.data || !item.id) {
                console.warn("âš  Item gallery corrupt, skip:", item);
                return;
            }

            galleryImages.push(item);

            if (item.type === 'photo') {
                const thumb = document.createElement('img');
                thumb.className = "thumb";
                thumb.src = item.data;
                thumb.setAttribute('data-id', item.id);
                thumb.onclick = () => {
                    currentIndex = index;
                    showingPhoto = true;
                    showOnCamera(index);
                };

                // ğŸ¯ STYLE YANG SAMA
                thumb.style.width = "140px";
                thumb.style.height = "105px";
                thumb.style.objectFit = "cover";
                thumb.style.borderRadius = "12px";
                thumb.style.flexShrink = "0";
                thumb.style.display = "block";

                gallery.appendChild(thumb);
            } else if (item.type === 'video') {
                // VIDEO: PASTIKAN DATA MASIH VALID
                if (item.data && (item.data.startsWith('data:') || item.data.startsWith('blob:'))) {
                    const videoContainer = document.createElement('div');
                    videoContainer.style.position = 'relative';
                    videoContainer.style.display = 'inline-block';
                    videoContainer.setAttribute('data-id', item.id);

                    videoContainer.style.width = "100px";
                    videoContainer.style.height = "75px";
                    videoContainer.style.borderRadius = "18px";
                    videoContainer.style.overflow = "hidden"; // âœ… PENTING!
                    videoContainer.style.flexShrink = "0"; // âœ… AGAR TIDAK TERSEBAR

                    const vid = document.createElement('video');
                    vid.src = item.data;
                    vid.className = "thumb";
                    vid.muted = true;
                    vid.loop = true;
                    vid.autoplay = true;
                    vid.style.transform = "scaleX(1)";
                    vid.controls = false;

                    vid.style.width = "100%";
                    vid.style.height = "100%";
                    vid.style.objectFit = "cover"; // âœ… INI YANG MEMPERBAIKI!
                    vid.style.borderRadius = "18px";

                    const controlsOverlay = document.createElement('div');
                    controlsOverlay.style.position = 'absolute';
                    controlsOverlay.style.bottom = '5px';
                    controlsOverlay.style.left = '5px';
                    controlsOverlay.style.right = '5px';
                    controlsOverlay.style.background = 'rgba(0,0,0,0.7)';
                    controlsOverlay.style.borderRadius = '10px';
                    controlsOverlay.style.padding = '5px';
                    controlsOverlay.style.display = 'flex';
                    controlsOverlay.style.alignItems = 'center';
                    controlsOverlay.style.gap = '8px';
                    controlsOverlay.style.fontSize = '10px';
                    controlsOverlay.style.color = 'white';

                    const playBtn = document.createElement('button');
                    playBtn.innerHTML = 'â–¶';
                    playBtn.style.background = 'none';
                    playBtn.style.border = 'none';
                    playBtn.style.color = 'white';
                    playBtn.style.cursor = 'pointer';
                    playBtn.style.fontSize = '12px';

                    const timeDisplay = document.createElement('span');
                    timeDisplay.textContent = '0:00';

                    controlsOverlay.appendChild(playBtn);
                    controlsOverlay.appendChild(timeDisplay);

                    videoContainer.appendChild(vid);
                    videoContainer.appendChild(controlsOverlay);

                    playBtn.onclick = (e) => {
                        e.stopPropagation();
                        if (vid.paused) {
                            vid.play();
                            playBtn.innerHTML = 'âšâš';
                        } else {
                            vid.pause();
                            playBtn.innerHTML = 'â–¶';
                        }
                    };

                    vid.ontimeupdate = () => {
                        const minutes = Math.floor(vid.currentTime / 60);
                        const seconds = Math.floor(vid.currentTime % 60);
                        timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    };

                    videoContainer.onclick = () => {
                        currentIndex = index;
                        showVideoOnCamera(item.data, true);
                    };

                    gallery.appendChild(videoContainer);
                } else {
                    console.warn("â° Video data invalid, skip:", item.id);
                }
            }
        });

         // ğŸ¯ SCROLL KE FOTO TERBARU DENGAN PRESISI
        setTimeout(() => {
            const gallery = document.getElementById('gallery');
            if (gallery && gallery.children.length > 0) {
                const maxScroll = gallery.scrollWidth - gallery.clientWidth;
                gallery.scrollTo({
                    left: maxScroll,
                    behavior: 'auto'
                });
                
                updateScrollButtons();
                console.log('ğŸ  Load gallery - scroll ke terbaru:', maxScroll);
            }
        }, 500);
    }
}
// âœ… FUNGSI KONVERSI BLOB KE BASE64
function blobToBase64(blob) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}

// âœ… FUNGSI BARU: CLEANUP LOCALSTORAGE JIKA QUOTA PENUH
function cleanupLocalStorage() {
    try {
        // âœ… HAPUS GALLERY DATA YANG LAMA UNTUK FREE UP SPACE
        if (currentUser && currentUser.gallery) {
            // SIMPAN HANYA 10 ITEM TERBARU (bukan 5)
            if (currentUser.gallery.length > 10) {
                currentUser.gallery = currentUser.gallery.slice(-10);
                
                // âœ… UPDATE JUGA galleryImages
                galleryImages = [...currentUser.gallery];
                
                localStorage.setItem('user_' + currentUser.email, JSON.stringify(currentUser));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                console.log(" ğŸ”§ Cleanup gallery: hanya simpan 10 item terbaru");
                
                // âœ… RELOAD GALLERY SETELAH CLEANUP
                loadUserGallery();
            }
        }
    } catch (e) {
        console.error(" âŒ Gagal cleanup localStorage:", e);
    }
}

// âœ… FUNGSI UNTUK PETUNJUK PENGGUNAAN
function showPetunjukPenggunaan() {
    const modal = document.getElementById('petunjukModal');
    modal.style.display = 'flex';
    
    // Reset ke tab pertama
    switchTab('panduan-cepat');
}

function tutupPetunjuk() {
    const modal = document.getElementById('petunjukModal');
    modal.style.display = 'none';
    closeSidebar();
}

function switchTab(tabName) {
    // Remove active class dari semua tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Remove active class dari semua tab panes
    document.querySelectorAll('.tab-pane').forEach(pane => {
        pane.classList.remove('active');
    });
    
    // Add active class ke tab yang diklik
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    document.getElementById(tabName).classList.add('active');
}

// âœ… EVENT LISTENER UNTUK TUTUP MODAL
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('petunjukModal');
    const closeBtn = document.querySelector('.close-modal');
    
    if (closeBtn) {
        closeBtn.addEventListener('click', tutupPetunjuk);
    }
    
    // Tutup modal kalau klik di luar content
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            tutupPetunjuk();
        }
    });
    
    // Event listener untuk tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            switchTab(tabName);
        });
    });
});

//  FUNGSI BARU: UPDATE POSISI DOWNLOAD BUTTON UNTUK RESPONSIVE
function updateDownloadButtonPosition() {
    const downloadSection = document.getElementById('download-section');
    const gallery = document.getElementById('gallery');
    
    if (downloadSection && gallery) {
        const galleryRect = gallery.getBoundingClientRect();
        
        // Jika gallery ada konten, posisikan di samping gallery
        if (gallery.children.length > 0) {
            downloadSection.style.bottom = '30px';
            downloadSection.style.right = '20px';
        } else {
            downloadSection.style.bottom = '30px';
            downloadSection.style.right = '20px';
        }
    }
}

// ğŸ  FUNGSI SCROLL GALLERY YANG PRESISI
function scrollGalleryLeft() {
    const gallery = document.getElementById('gallery');
    if (!gallery) return;
    
    // ğŸ¯ HITUNG POSISI YANG PRESISI
    const thumbWidth = 140; // width thumbnail
    const gap = 15; // gap antara thumbnail
    const thumbWithGap = thumbWidth + gap;
    
    // ğŸ¯ SCROLL KE THUMBNAIL SEBELUMNYA YANG UTUH
    const currentScroll = gallery.scrollLeft;
    const targetScroll = Math.floor(currentScroll / thumbWithGap) * thumbWithGap - thumbWithGap;
    
    gallery.scrollTo({
        left: Math.max(0, targetScroll), // ğŸ¯ PASTIKAN TIDAK KURANG DARI 0
        behavior: 'smooth'
    });
    
    console.log('â† Scroll kiri presisi:', { 
        from: currentScroll, 
        to: Math.max(0, targetScroll),
        thumbWidth: thumbWithGap
    });
    
    // UPDATE TOMBOL SETELAH SCROLL
    setTimeout(updateScrollButtons, 400);
}

// ğŸ  FUNGSI SCROLL GALLERY YANG SIMPLE
function scrollGalleryLeft() {
    const gallery = document.getElementById('gallery');
    if (!gallery) return;
    
    // ğŸ¯ SCROLL 1 THUMBNAIL + GAP KE KIRI
    const scrollAmount = 140 + 15; // width + gap
    
    gallery.scrollBy({
        left: -scrollAmount,
        behavior: 'smooth'
    });
    
    console.log('â† Scroll kiri:', scrollAmount + 'px');
    
    // ğŸ¯ UPDATE TOMBOL SETELAH SCROLL SELESAI
    setTimeout(updateScrollButtons, 500);
}

function scrollGalleryRight() {
    const gallery = document.getElementById('gallery');
    if (!gallery) return;
    
    // ğŸ¯ SCROLL 1 THUMBNAIL + GAP KE KANAN
    const scrollAmount = 140 + 15; // width + gap
    
    gallery.scrollBy({
        left: scrollAmount,
        behavior: 'smooth'
    });
    
    console.log('â†’ Scroll kanan:', scrollAmount + 'px');
    
    // ğŸ¯ UPDATE TOMBOL SETELAH SCROLL SELESAI
    setTimeout(updateScrollButtons, 500);
}

// ğŸ  FUNGSI UPDATE TOMBOL SCROLL YANG SUPER SIMPLE
function updateScrollButtons() {
    const gallery = document.getElementById('gallery');
    const scrollLeftBtn = document.getElementById('scrollLeftBtn');
    const scrollRightBtn = document.getElementById('scrollRightBtn');

    if (!gallery || !scrollLeftBtn || !scrollRightBtn) {
        return;
    }

    const totalItems = gallery.children.length;
    
    // ğŸ¯ LOGIKA SANGAT SIMPLE:
    // - Tombol kiri: tampil jika BUKAN di posisi paling kiri
    // - Tombol kanan: tampil jika BUKAN di posisi paling kanan
    
    const isAtStart = gallery.scrollLeft <= 5;
    const isAtEnd = gallery.scrollLeft >= (gallery.scrollWidth - gallery.clientWidth - 5);
    
    console.log('ğŸ  Posisi Scroll:', {
        scrollLeft: gallery.scrollLeft,
        scrollWidth: gallery.scrollWidth,
        clientWidth: gallery.clientWidth,
        isAtStart: isAtStart,
        isAtEnd: isAtEnd,
        totalItems: totalItems
    });

    // ğŸ¯ TAMPILKAN TOMBOL HANYA JIKA ADA LEBIH DARI 3 ITEM
    if (totalItems > 3) {
        scrollLeftBtn.style.display = isAtStart ? 'none' : 'flex';
        scrollRightBtn.style.display = isAtEnd ? 'none' : 'flex';
        
        console.log('ğŸ  Status Tombol:', {
            kiri: isAtStart ? 'HIDDEN' : 'SHOW',
            kanan: isAtEnd ? 'HIDDEN' : 'SHOW'
        });
    } else {
        // ğŸ¯ JIKA KURANG DARI 4 ITEM, SEMBUNYIKAN SEMUA TOMBOL
        scrollLeftBtn.style.display = 'none';
        scrollRightBtn.style.display = 'none';
        console.log('ğŸ  Tombol disembunyikan - kurang dari 4 item');
    }
}

// ğŸ  FUNGSI UNTUK MEMASTIKAN THUMBNAIL TERTATA DENGAN BAIK
function limitVisibleThumbnails() {
    const gallery = document.getElementById('gallery');
    if (!gallery) return;
    
    const thumbs = gallery.children;
    const maxVisible = 8; // Maksimal thumbnail yang disimpan
    
    if (thumbs.length > maxVisible) {
        // Hapus thumbnail terlama (yang paling kiri)
        for (let i = 0; i < thumbs.length - maxVisible; i++) {
            if (thumbs[0]) {
                thumbs[0].remove();
            }
        }
        console.log(`ğŸ  Dibersihkan ${thumbs.length - maxVisible} thumbnail terlama`);
    }
    
    updateScrollButtons();
}

// ğŸ¯ EVENT LISTENER UNTUK DETEKSI SCROLL MANUAL
// ğŸ¯ EVENT LISTENER UNTUK SCROLL REAL-TIME
document.addEventListener('DOMContentLoaded', function() {
    const gallery = document.getElementById('gallery');
    if (gallery) {
        // ğŸ¯ UPDATE TOMBOL SAAT USER SCROLL MANUAL
        gallery.addEventListener('scroll', function() {
            // ğŸ¯ GUNAKAN DEBOUNCE UNTUK PERFORMANCE
            clearTimeout(gallery.scrollTimeout);
            gallery.scrollTimeout = setTimeout(updateScrollButtons, 50);
        });
    }
});

</script>  
</body>  
</html>
